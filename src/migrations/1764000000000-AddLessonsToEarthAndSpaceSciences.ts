import { MigrationInterface, QueryRunner } from 'typeorm';

/**
 * Миграция для добавления уроков к дисциплинам "Науки о Земле и космосе"
 * 
 * Дисциплины:
 * - География
 * - Астрономия
 * - Экология
 * 
 * Для каждой темы создается от 4 до 10 уроков с конкретными названиями.
 */

export class AddLessonsToEarthAndSpaceSciences1764000000000
  implements MigrationInterface
{
  name = 'AddLessonsToEarthAndSpaceSciences1764000000000';

  /**
   * Экранирует строку для SQL
   */
  private escapeString(str: string): string {
    return `'${str.replace(/'/g, "''")}'`;
  }

  /**
   * Генерирует уроки для темы
   */
  private generateLessonsForTopic(
    topicId: string,
    topicName: string,
    lessonCount: number,
    lessonNames: string[],
    startLessonId: number,
  ): Array<{
    LessonID: string;
    ID: number;
    LessonName: string;
    TopicID: string;
    IsVerified: boolean;
    Order: number;
    Description: string | null;
    CreatedAt: Date;
    UpdatedAt: Date;
  }> {
    const lessons: Array<{
      LessonID: string;
      ID: number;
      LessonName: string;
      TopicID: string;
      IsVerified: boolean;
      Order: number;
      Description: string | null;
      CreatedAt: Date;
      UpdatedAt: Date;
    }> = [];
    const baseDate = new Date('2025-08-16T12:00:00Z');

    for (let i = 0; i < lessonCount; i++) {
      const tempId = `temp-${topicId}-${startLessonId + i}`;
      lessons.push({
        LessonID: tempId,
        ID: startLessonId + i,
        LessonName: lessonNames[i] || `Урок ${i + 1}: ${topicName}`,
        TopicID: topicId,
        IsVerified: false,
        Order: i + 1,
        Description: null,
        CreatedAt: baseDate,
        UpdatedAt: baseDate,
      });
    }

    return lessons;
  }

  /**
   * Получает план уроков для темы на основе её названия
   * Названия уроков сделаны конкретными, не абстрактными
   */
  private getLessonPlanForTopic(topicName: string): {
    count: number;
    names: string[];
  } {
    const lowerTopicName = topicName.toLowerCase();

    // === ГЕОГРАФИЯ ===

    // География как наука
    if (lowerTopicName.includes('география как наука') || lowerTopicName.includes('источники, методы')) {
      return {
        count: 6,
        names: [
          'Что изучает география: физическая и экономическая',
          'Источники географической информации: карты, спутники, экспедиции',
          'Методы географических исследований: наблюдение, описание, анализ',
          'Направления географии: общая и региональная',
          'Практика: работа с географическими источниками',
          'География в современном мире',
        ],
      };
    }

    // Земля как планета
    if (lowerTopicName.includes('земля как планета') || lowerTopicName.includes('форма, движения') || lowerTopicName.includes('координаты и часовые пояса')) {
      return {
        count: 7,
        names: [
          'Форма Земли: геоид и эллипсоид',
          'Движение Земли вокруг оси: суточное вращение',
          'Движение Земли вокруг Солнца: годичное обращение',
          'Географические координаты: широта и долгота',
          'Часовые пояса: как определить время',
          'Практика: определение координат на карте',
          'Влияние движений Земли на природу',
        ],
      };
    }

    // Картография
    if (lowerTopicName.includes('картография') || lowerTopicName.includes('масштаб') || lowerTopicName.includes('картографические проекции')) {
      return {
        count: 7,
        names: [
          'Масштаб: численный, именованный, линейный',
          'План местности: изображение небольшой территории',
          'Условные знаки: как читать карту',
          'Картографические проекции: способы изображения',
          'Топографическая карта: рельеф и объекты',
          'Практика: работа с картой и планом',
          'Создание простого плана местности',
        ],
      };
    }

    // ГИС и ДЗЗ
    if (lowerTopicName.includes('гис') || lowerTopicName.includes('дистанционное зондирование')) {
      return {
        count: 6,
        names: [
          'ГИС: географические информационные системы',
          'Слои в ГИС: как работает система',
          'Дистанционное зондирование: спутниковые снимки',
          'Применение ГИС: навигация, планирование, мониторинг',
          'Практика: работа с простой ГИС',
          'Современные технологии в географии',
        ],
      };
    }

    // Литосфера
    if (lowerTopicName.includes('литосфера') || lowerTopicName.includes('строение земли') || lowerTopicName.includes('тектоника плит')) {
      return {
        count: 8,
        names: [
          'Строение Земли: ядро, мантия, кора',
          'Тектоника плит: движение литосферных плит',
          'Границы плит: расходящиеся и сходящиеся',
          'Рельеф материков: горы, равнины, плато',
          'Рельеф океанов: хребты, впадины, равнины',
          'Практика: анализ карты рельефа',
          'Связь рельефа и тектоники',
          'Современные движения земной коры',
        ],
      };
    }

    // Рельефообразующие процессы
    if (lowerTopicName.includes('рельефообразующие процессы')) {
      return {
        count: 6,
        names: [
          'Внутренние процессы: вулканизм и землетрясения',
          'Внешние процессы: выветривание и эрозия',
          'Работа воды: реки и овраги',
          'Работа ветра: дюны и барханы',
          'Работа ледников: морены и фьорды',
          'Практика: определение процессов по рельефу',
        ],
      };
    }

    // Полезные ископаемые
    if (lowerTopicName.includes('полезные ископаемые') || lowerTopicName.includes('минеральные ресурсы')) {
      return {
        count: 6,
        names: [
          'Виды полезных ископаемых: рудные и нерудные',
          'Месторождения: как образуются залежи',
          'Распределение по материкам: основные бассейны',
          'Нефть и газ: где добывают',
          'Уголь и руды: крупнейшие месторождения',
          'Практика: работа с картой полезных ископаемых',
        ],
      };
    }

    // Атмосфера
    if (lowerTopicName.includes('атмосфера') || lowerTopicName.includes('атмосферные процессы')) {
      return {
        count: 7,
        names: [
          'Состав атмосферы: азот, кислород, углекислый газ',
          'Строение атмосферы: тропосфера, стратосфера, ионосфера',
          'Атмосферное давление: что это такое',
          'Ветер: причины образования',
          'Облака и осадки: как образуются',
          'Практика: наблюдение за погодой',
          'Влияние атмосферы на жизнь',
        ],
      };
    }

    // Погода и климат
    if (lowerTopicName.includes('погода и климат') || lowerTopicName.includes('климатические пояса')) {
      return {
        count: 8,
        names: [
          'Погода: состояние атмосферы сейчас',
          'Климат: многолетний режим погоды',
          'Факторы климата: широта, высота, океаны',
          'Типы климатов: экваториальный, тропический, умеренный',
          'Климатические пояса: распределение по Земле',
          'Климат России: особенности',
          'Практика: анализ климатических карт',
          'Изменение климата: глобальное потепление',
        ],
      };
    }

    // Гидросфера: Мировой океан
    if (lowerTopicName.includes('гидросфера') || lowerTopicName.includes('мировой океан') || lowerTopicName.includes('океанические течения')) {
      return {
        count: 7,
        names: [
          'Мировой океан: Тихий, Атлантический, Индийский, Северный Ледовитый',
          'Океанические течения: тёплые и холодные',
          'Влияние течений на климат',
          'Ресурсы океана: рыба, нефть, минералы',
          'Глубины океанов: Марианская впадина',
          'Практика: работа с картой океанов',
          'Охрана океанов: экологические проблемы',
        ],
      };
    }

    // Внутренние воды
    if (lowerTopicName.includes('внутренние воды') || lowerTopicName.includes('реки, озёра')) {
      return {
        count: 7,
        names: [
          'Реки: исток, устье, бассейн',
          'Озёра: пресные и солёные',
          'Болота: как образуются',
          'Подземные воды: артезианские и грунтовые',
          'Ледники: горные и покровные',
          'Практика: описание реки по карте',
          'Водные ресурсы: использование и охрана',
        ],
      };
    }

    // Биосфера и природные зоны
    if (lowerTopicName.includes('биосфера и природные зоны') || lowerTopicName.includes('широтная зональность')) {
      return {
        count: 7,
        names: [
          'Биосфера: оболочка жизни',
          'Широтная зональность: смена зон от экватора к полюсам',
          'Высотная поясность: смена зон в горах',
          'Природные зоны: тундра, тайга, степь, пустыня',
          'Животный и растительный мир зон',
          'Практика: определение природной зоны',
          'Охрана биосферы',
        ],
      };
    }

    // Почвы
    if (lowerTopicName.includes('почвы') || lowerTopicName.includes('земельные ресурсы') || lowerTopicName.includes('почвообразования')) {
      return {
        count: 6,
        names: [
          'Что такое почва: состав и свойства',
          'Факторы почвообразования: климат, рельеф, организмы',
          'Типы почв: чернозём, подзол, серозём',
          'Земельные ресурсы: использование почв',
          'Практика: определение типа почвы',
          'Охрана почв: борьба с эрозией',
        ],
      };
    }

    // Природные комплексы
    if (lowerTopicName.includes('природные комплексы') || lowerTopicName.includes('ландшафты')) {
      return {
        count: 6,
        names: [
          'Природный комплекс: взаимосвязь компонентов',
          'Ландшафт: природный комплекс на местности',
          'Виды ландшафтов: природные и антропогенные',
          'Взаимосвязь компонентов природы',
          'Практика: описание природного комплекса',
          'Охрана ландшафтов',
        ],
      };
    }

    // Природные опасности
    if (lowerTopicName.includes('природные опасности') || lowerTopicName.includes('риски') || lowerTopicName.includes('землетрясения, вулканизм')) {
      return {
        count: 7,
        names: [
          'Землетрясения: причины и последствия',
          'Вулканизм: извержения вулканов',
          'Наводнения: причины и защита',
          'Засухи: влияние на природу и человека',
          'Оползни и сели: опасные явления',
          'Практика: анализ карты опасных зон',
          'Меры защиты от природных опасностей',
        ],
      };
    }

    // Население мира
    if (lowerTopicName.includes('население мира') || lowerTopicName.includes('численность, динамика') || lowerTopicName.includes('демографические процессы')) {
      return {
        count: 7,
        names: [
          'Численность населения: сколько людей на Земле',
          'Динамика населения: рост и убыль',
          'Рождаемость и смертность: демографические показатели',
          'Демографический взрыв: причины роста',
          'Практика: анализ демографических карт',
          'Старение населения: проблемы',
          'Демографическая политика',
        ],
      };
    }

    // Миграции и урбанизация
    if (lowerTopicName.includes('миграции') || lowerTopicName.includes('урбанизация') || lowerTopicName.includes('расселение')) {
      return {
        count: 7,
        names: [
          'Миграции: причины перемещения людей',
          'Виды миграций: внутренние и внешние',
          'Урбанизация: рост городов',
          'Города и агломерации: крупнейшие мегаполисы',
          'Расселение: городское и сельское',
          'Практика: анализ карты расселения',
          'Проблемы урбанизации',
        ],
      };
    }

    // Мировое хозяйство
    if (lowerTopicName.includes('мировое хозяйство') || lowerTopicName.includes('структура, специализация') || lowerTopicName.includes('глобальные цепочки')) {
      return {
        count: 6,
        names: [
          'Структура мирового хозяйства: отрасли',
          'Специализация стран: что производят',
          'Глобальные цепочки: от сырья до товара',
          'Развитые и развивающиеся страны',
          'Практика: анализ экономических карт',
          'Глобализация экономики',
        ],
      };
    }

    // Промышленность
    if (lowerTopicName.includes('промышленность') || lowerTopicName.includes('добыча, обрабатывающие отрасли') || lowerTopicName.includes('энергетика')) {
      return {
        count: 7,
        names: [
          'Добывающая промышленность: руда, уголь, нефть',
          'Обрабатывающая промышленность: машины, химия',
          'Энергетика: электростанции и источники энергии',
          'Крупнейшие промышленные районы мира',
          'Промышленность России',
          'Практика: работа с картой промышленности',
          'Экологические проблемы промышленности',
        ],
      };
    }

    // Сельское хозяйство
    if (lowerTopicName.includes('сельское хозяйство') || lowerTopicName.includes('продовольственные системы')) {
      return {
        count: 6,
        names: [
          'Растениеводство: выращивание культур',
          'Животноводство: разведение животных',
          'Сельскохозяйственные районы мира',
          'Продовольственные системы: от поля до стола',
          'Практика: анализ карты сельского хозяйства',
          'Проблемы продовольственной безопасности',
        ],
      };
    }

    // Транспорт
    if (lowerTopicName.includes('транспорт') || lowerTopicName.includes('логистика') || lowerTopicName.includes('мировая инфраструктура')) {
      return {
        count: 6,
        names: [
          'Виды транспорта: автомобильный, железнодорожный, водный, воздушный',
          'Транспортные магистрали: важнейшие пути',
          'Логистика: организация перевозок',
          'Мировая инфраструктура: порты, аэропорты, вокзалы',
          'Практика: анализ транспортной сети',
          'Транспорт будущего: экологичные виды',
        ],
      };
    }

    // География услуг
    if (lowerTopicName.includes('география услуг') || lowerTopicName.includes('туризма') || lowerTopicName.includes('креативной экономики')) {
      return {
        count: 6,
        names: [
          'Сфера услуг: что это такое',
          'Туризм: популярные направления',
          'Креативная экономика: культура и технологии',
          'Финансовые центры: банки и биржи',
          'Практика: анализ карты туризма',
          'Развитие сферы услуг',
        ],
      };
    }

    // Глобализация
    if (lowerTopicName.includes('глобализация') || lowerTopicName.includes('международная торговля') || lowerTopicName.includes('интеграции')) {
      return {
        count: 6,
        names: [
          'Глобализация: единое экономическое пространство',
          'Международная торговля: экспорт и импорт',
          'Экономические интеграции: ЕС, НАФТА, АСЕАН',
          'Транснациональные корпорации',
          'Практика: анализ торговых связей',
          'Проблемы глобализации',
        ],
      };
    }

    // Регионы мира
    if (lowerTopicName.includes('регионы мира') || lowerTopicName.includes('материки, субрегионы')) {
      return {
        count: 7,
        names: [
          'Материки: Евразия, Африка, Северная и Южная Америка, Австралия, Антарктида',
          'Субрегионы: части материков',
          'Ключевые страны: крупнейшие государства',
          'Особенности регионов: природа и хозяйство',
          'Практика: характеристика региона',
          'Сравнение регионов',
          'Современные проблемы регионов',
        ],
      };
    }

    // Россия: географическое положение
    if (lowerTopicName.includes('россия: географическое положение') || lowerTopicName.includes('границы') || lowerTopicName.includes('физико-географические условия')) {
      return {
        count: 7,
        names: [
          'Географическое положение России: размеры и границы',
          'Границы: сухопутные и морские',
          'Физико-географические условия: рельеф и климат',
          'Природные зоны России',
          'Практика: описание географического положения',
          'Преимущества и недостатки положения',
          'Россия на карте мира',
        ],
      };
    }

    // Природные ресурсы России
    if (lowerTopicName.includes('природные ресурсы и экологические проблемы россии')) {
      return {
        count: 6,
        names: [
          'Природные ресурсы России: богатство страны',
          'Минеральные ресурсы: нефть, газ, уголь, руды',
          'Водные и лесные ресурсы',
          'Экологические проблемы: загрязнение и истощение',
          'Практика: анализ карты ресурсов',
          'Охрана природы в России',
        ],
      };
    }

    // Население и хозяйство России
    if (lowerTopicName.includes('население и хозяйство россии') || lowerTopicName.includes('экономические районы')) {
      return {
        count: 7,
        names: [
          'Население России: численность и размещение',
          'Экономические районы: специализация',
          'Промышленность России: основные отрасли',
          'Сельское хозяйство: регионы производства',
          'Транспортная система России',
          'Практика: характеристика экономического района',
          'Проблемы развития хозяйства',
        ],
      };
    }

    // Федеральные округа
    if (lowerTopicName.includes('федеральные округа россии') || lowerTopicName.includes('профиль и специализация регионов')) {
      return {
        count: 7,
        names: [
          'Федеральные округа: административное деление',
          'Центральный федеральный округ: столичный регион',
          'Северо-Западный округ: Санкт-Петербург и регионы',
          'Сибирский и Дальневосточный округа: ресурсы и развитие',
          'Специализация регионов: что производят',
          'Практика: характеристика федерального округа',
          'Региональная политика',
        ],
      };
    }

    // Страны СНГ
    if (lowerTopicName.includes('страны снг') || lowerTopicName.includes('экономико-географическая характеристика')) {
      return {
        count: 6,
        names: [
          'СНГ: страны Содружества',
          'Экономико-географическая характеристика: природа и хозяйство',
          'Крупнейшие страны: Украина, Казахстан, Беларусь',
          'Экономические связи с Россией',
          'Практика: сравнение стран СНГ',
          'Проблемы интеграции',
        ],
      };
    }

    // Охраняемые территории
    if (lowerTopicName.includes('охраняемые природные территории') || lowerTopicName.includes('устойчивое природопользование')) {
      return {
        count: 6,
        names: [
          'Охраняемые территории: заповедники, национальные парки',
          'Заповедники России: Байкальский, Кроноцкий',
          'Устойчивое природопользование: баланс использования и охраны',
          'Экологические проблемы и их решение',
          'Практика: создание проекта охраняемой территории',
          'Международное сотрудничество в охране природы',
        ],
      };
    }

    // Полевые исследования
    if (lowerTopicName.includes('полевые исследования') || lowerTopicName.includes('геопроекты')) {
      return {
        count: 6,
        names: [
          'Полевые исследования: работа на местности',
          'Методы полевых исследований: наблюдение, описание, измерение',
          'Школьные геопроекты: темы и методы',
          'Оформление результатов исследования',
          'Практика: проведение полевого исследования',
          'Защита геопроекта',
        ],
      };
    }

    // Практикум по ГИС
    if (lowerTopicName.includes('практикум по гис') || lowerTopicName.includes('картографированию в проектах')) {
      return {
        count: 6,
        names: [
          'Работа с ГИС: создание карты',
          'Добавление слоёв: объекты и явления',
          'Анализ данных: поиск закономерностей',
          'Создание карты для проекта',
          'Практика: создание карты в ГИС',
          'Презентация картографического проекта',
        ],
      };
    }

    // === АСТРОНОМИЯ ===

    // Астрономия как наука
    if (lowerTopicName.includes('астрономия как наука') || lowerTopicName.includes('что изучает') || lowerTopicName.includes('методы наблюдений')) {
      return {
        count: 6,
        names: [
          'Что изучает астрономия: небесные тела и Вселенная',
          'Место астрономии в системе наук',
          'Методы наблюдений: телескопы и обсерватории',
          'История астрономических открытий',
          'Практика: работа с астрономическими приборами',
          'Современная астрономия',
        ],
      };
    }

    // История астрономии
    if (lowerTopicName.includes('история астрономии') || lowerTopicName.includes('геоцентрическая и гелиоцентрическая') || lowerTopicName.includes('коперник, кеплер')) {
      return {
        count: 8,
        names: [
          'Древние представления о мире: мифы и наблюдения',
          'Геоцентрическая модель: Земля в центре',
          'Гелиоцентрическая модель: Солнце в центре',
          'Коперник: революция в астрономии',
          'Кеплер: законы движения планет',
          'Галилей: телескоп и открытия',
          'Ньютон: законы всемирного тяготения',
          'Практика: сравнение моделей Вселенной',
        ],
      };
    }

    // Небесная сфера
    if (lowerTopicName.includes('небесная сфера') || lowerTopicName.includes('горизонто-горизонтальная система') || lowerTopicName.includes('высота и азимут')) {
      return {
        count: 7,
        names: [
          'Небесная сфера: воображаемая сфера вокруг Земли',
          'Основные направления: север, юг, восток, запад',
          'Горизонто-горизонтальная система координат',
          'Небесный меридиан: линия через зенит',
          'Высота светила: угол над горизонтом',
          'Азимут: направление на светило',
          'Практика: определение координат светил',
        ],
      };
    }

    // Видимое движение светил
    if (lowerTopicName.includes('видимое движение светил') || lowerTopicName.includes('суточное движение') || lowerTopicName.includes('годичное движение солнца')) {
      return {
        count: 7,
        names: [
          'Суточное движение: вращение небесной сферы',
          'Годичное движение Солнца: путь по эклиптике',
          'Созвездия: группы звёзд на небе',
          'Звёздное небо весной: какие созвездия видны',
          'Звёздное небо летом: летний треугольник',
          'Звёздное небо осенью и зимой',
          'Практика: наблюдение звёздного неба',
        ],
      };
    }

    // Созвездия
    if (lowerTopicName.includes('созвездия и звёздное небо') || lowerTopicName.includes('полярная звезда')) {
      return {
        count: 6,
        names: [
          'Названия созвездий: Большая Медведица, Орион, Кассиопея',
          'Расположение основных созвездий на небе',
          'Полярная звезда: как найти север',
          'Ориентирование по звёздам',
          'Практика: поиск созвездий на небе',
          'Мифы о созвездиях',
        ],
      };
    }

    // Время в астрономии
    if (lowerTopicName.includes('время в астрономии') || lowerTopicName.includes('солнечные и звёздные сутки') || lowerTopicName.includes('часовые пояса')) {
      return {
        count: 7,
        names: [
          'Солнечные сутки: от полудня до полудня',
          'Звёздные сутки: вращение относительно звёзд',
          'Часовые пояса: деление Земли на зоны',
          'Поясное и местное время: разница',
          'Календарь: солнечный и лунный',
          'Високосный год: почему 366 дней',
          'Практика: определение времени в разных поясах',
        ],
      };
    }

    // Солнце
    if (lowerTopicName.includes('солнце: строение') || lowerTopicName.includes('солнечная активность') || lowerTopicName.includes('пятна, вспышки')) {
      return {
        count: 7,
        names: [
          'Строение Солнца: ядро, фотосфера, хромосфера',
          'Источники энергии: термоядерные реакции',
          'Солнечная активность: циклы активности',
          'Солнечные пятна: тёмные области',
          'Солнечные вспышки: мощные выбросы',
          'Влияние на Землю: магнитные бури',
          'Практика: наблюдение Солнца (безопасно!)',
        ],
      };
    }

    // Солнечная система
    if (lowerTopicName.includes('солнечная система: состав') || lowerTopicName.includes('солнце, планеты') || lowerTopicName.includes('астероиды, кометы')) {
      return {
        count: 8,
        names: [
          'Солнце: центр системы',
          'Планеты: восемь планет',
          'Спутники планет: Луна, спутники Юпитера',
          'Карликовые планеты: Плутон и другие',
          'Астероиды: малые планеты',
          'Кометы: хвостатые странницы',
          'Метеорные тела: космическая пыль',
          'Практика: создание модели Солнечной системы',
        ],
      };
    }

    // Планеты земной группы и гиганты
    if (lowerTopicName.includes('планеты земной группы') || lowerTopicName.includes('планеты-гиганты') || lowerTopicName.includes('сравнение размеров')) {
      return {
        count: 7,
        names: [
          'Планеты земной группы: Меркурий, Венера, Земля, Марс',
          'Планеты-гиганты: Юпитер, Сатурн, Уран, Нептун',
          'Сравнение размеров: кто больше',
          'Массы и плотности: различия',
          'Атмосферы планет: состав и давление',
          'Условия на поверхности: температура и давление',
          'Практика: сравнение планет',
        ],
      };
    }

    // Движение планет
    if (lowerTopicName.includes('движение планет по орбитам') || lowerTopicName.includes('законы кеплера') || lowerTopicName.includes('афелий, перигелий')) {
      return {
        count: 7,
        names: [
          'Эллиптические орбиты: форма пути планет',
          'Первый закон Кеплера: орбиты эллипсы',
          'Второй закон Кеплера: скорость движения',
          'Третий закон Кеплера: период и расстояние',
          'Афелий: самая дальняя точка',
          'Перигелий: самая близкая точка',
          'Синодический и сидерический периоды',
        ],
      };
    }

    // Земля как планета
    if (lowerTopicName.includes('земля как планета: форма') || lowerTopicName.includes('движение вокруг оси') || lowerTopicName.includes('смена дня и ночи')) {
      return {
        count: 7,
        names: [
          'Форма и размеры Земли: геоид',
          'Движение вокруг оси: суточное вращение',
          'Движение вокруг Солнца: годичное обращение',
          'Смена дня и ночи: следствие вращения',
          'Времена года: следствие обращения',
          'Практика: демонстрация движений Земли',
          'Влияние движений на природу',
        ],
      };
    }

    // Луна
    if (lowerTopicName.includes('луна: строение') || lowerTopicName.includes('фазы луны') || lowerTopicName.includes('затмения')) {
      return {
        count: 7,
        names: [
          'Строение Луны: кора, мантия, ядро',
          'Движение вокруг Земли: орбита',
          'Фазы Луны: новолуние, полнолуние, четверти',
          'Солнечное затмение: Луна закрывает Солнце',
          'Лунное затмение: Земля закрывает Луну',
          'Приливы и отливы: влияние Луны',
          'Практика: наблюдение фаз Луны',
        ],
      };
    }

    // Малые тела
    if (lowerTopicName.includes('малые тела солнечной системы') || lowerTopicName.includes('астероиды, кометы') || lowerTopicName.includes('метеоры, метеориты')) {
      return {
        count: 7,
        names: [
          'Астероиды: каменные тела',
          'Кометы: ледяные странницы',
          'Метеоры: падающие звёзды',
          'Метеориты: упавшие на Землю',
          'Метеорные потоки: Персеиды, Леониды',
          'Практика: наблюдение метеоров',
          'Опасность столкновений',
        ],
      };
    }

    // Освоение космоса
    if (lowerTopicName.includes('освоение космоса') || lowerTopicName.includes('спутники, пилотируемые полёты') || lowerTopicName.includes('космические станции')) {
      return {
        count: 7,
        names: [
          'Первые спутники: Спутник-1, запуск в 1957',
          'Пилотируемые полёты: Гагарин и другие',
          'Космические станции: МКС',
          'Автоматические межпланетные станции: к Марсу, Венере',
          'Луноходы и марсоходы: исследование планет',
          'Практика: создание проекта космической миссии',
          'Будущее космонавтики',
        ],
      };
    }

    // Строение звезды
    if (lowerTopicName.includes('строение звезды') || lowerTopicName.includes('эволюция звёзд') || lowerTopicName.includes('диаграмма герцшпрунга')) {
      return {
        count: 7,
        names: [
          'Строение звезды: ядро, оболочка',
          'Основные этапы эволюции: рождение, жизнь, смерть',
          'Звёздные величины: яркость звёзд',
          'Цвет и температура: связь характеристик',
          'Диаграмма Герцшпрунга–Рассела: классификация звёзд',
          'Практика: анализ диаграммы',
          'Судьба разных звёзд',
        ],
      };
    }

    // Звёздные скопления
    if (lowerTopicName.includes('звёздные скопления') || lowerTopicName.includes('туманности') || lowerTopicName.includes('межзвёздное вещество')) {
      return {
        count: 6,
        names: [
          'Звёздные скопления: рассеянные и шаровые',
          'Туманности: облака газа и пыли',
          'Межзвёздное вещество: материал между звёздами',
          'Рождение звёзд в туманностях',
          'Практика: наблюдение туманностей',
          'Красота космоса',
        ],
      };
    }

    // Галактики
    if (lowerTopicName.includes('галактики') || lowerTopicName.includes('млечный путь') || lowerTopicName.includes('масштабы вселенной')) {
      return {
        count: 7,
        names: [
          'Наша Галактика: Млечный Путь',
          'Строение Галактики: ядро, спиральные рукава',
          'Другие галактики: Андромеда, Треугольник',
          'Виды галактик: спиральные, эллиптические, неправильные',
          'Масштабы Вселенной: расстояния',
          'Практика: работа с картой галактик',
          'Структура Вселенной',
        ],
      };
    }

    // Расширение Вселенной
    if (lowerTopicName.includes('расширение вселенной') || lowerTopicName.includes('красное смещение') || lowerTopicName.includes('большой взрыв')) {
      return {
        count: 6,
        names: [
          'Расширение Вселенной: галактики разбегаются',
          'Красное смещение: доказательство расширения',
          'Большой взрыв: начало Вселенной',
          'Возраст Вселенной: 13,8 миллиардов лет',
          'Практика: анализ данных о расширении',
          'Будущее Вселенной',
        ],
      };
    }

    // Космология
    if (lowerTopicName.includes('космология') || lowerTopicName.includes('строение и эволюция вселенной')) {
      return {
        count: 6,
        names: [
          'Современное представление о строении Вселенной',
          'Эволюция Вселенной: от Большого взрыва до наших дней',
          'Тёмная материя и тёмная энергия: загадки космоса',
          'Структура Вселенной: скопления галактик',
          'Практика: создание модели Вселенной',
          'Границы нашего знания',
        ],
      };
    }

    // Наблюдательная астрономия
    if (lowerTopicName.includes('наблюдательная астрономия') || lowerTopicName.includes('невооружённый глаз') || lowerTopicName.includes('телескоп')) {
      return {
        count: 7,
        names: [
          'Наблюдение невооружённым глазом: что можно увидеть',
          'Бинокль: первые инструменты',
          'Телескоп: рефрактор и рефлектор',
          'Астрономические приложения: Stellarium, Sky Map',
          'Карты звёздного неба: как пользоваться',
          'Практика: наблюдение звёздного неба',
          'Выбор инструментов для наблюдений',
        ],
      };
    }

    // Астрономические наблюдения
    if (lowerTopicName.includes('астрономические наблюдения в быту') || lowerTopicName.includes('планирование наблюдений') || lowerTopicName.includes('световое загрязнение')) {
      return {
        count: 6,
        names: [
          'Планирование наблюдений: когда и где смотреть',
          'Световое загрязнение: проблема городов',
          'Правила безопасности: как наблюдать Солнце',
          'Лазеры: опасность для глаз',
          'Практика: организация наблюдений',
          'Места для наблюдений: город и деревня',
        ],
      };
    }

    // Астрономия и навигация
    if (lowerTopicName.includes('астрономия и навигация') || lowerTopicName.includes('ориентирование по солнцу') || lowerTopicName.includes('историческая роль')) {
      return {
        count: 6,
        names: [
          'Ориентирование по Солнцу: определение сторон света',
          'Ориентирование по звёздам: Полярная звезда',
          'Историческая роль в мореплавании',
          'Астрономия в географии: определение координат',
          'Практика: ориентирование по небесным светилам',
          'Современная навигация: GPS и астрономия',
        ],
      };
    }

    // Влияние астрономических явлений
    if (lowerTopicName.includes('влияние астрономических явлений') || lowerTopicName.includes('космическая погода') || lowerTopicName.includes('магнитные бури')) {
      return {
        count: 7,
        names: [
          'Космическая погода: влияние Солнца',
          'Магнитные бури: возмущения магнитного поля',
          'Радиационный пояс: защита Земли',
          'Защита атмосферы: роль магнитного поля',
          'Влияние на здоровье человека',
          'Практика: мониторинг космической погоды',
          'Защита от космической радиации',
        ],
      };
    }

    // Космические технологии
    if (lowerTopicName.includes('космические технологии в повседневной жизни') || lowerTopicName.includes('связь, навигация') || lowerTopicName.includes('дистанционное зондирование')) {
      return {
        count: 6,
        names: [
          'Связь: спутниковая телефония и интернет',
          'Навигация: GPS и ГЛОНАСС',
          'Дистанционное зондирование Земли: спутниковые снимки',
          'Прогноз погоды: метеорологические спутники',
          'Практика: использование спутниковых сервисов',
          'Будущее космических технологий',
        ],
      };
    }

    // Астрономия и культура
    if (lowerTopicName.includes('астрономия, философия и культура') || lowerTopicName.includes('место человека во вселенной') || lowerTopicName.includes('астрономические мотивы')) {
      return {
        count: 6,
        names: [
          'Место человека во Вселенной: космическая перспектива',
          'Астрономические мотивы в мифах: созвездия',
          'Астрономия в литературе: научная фантастика',
          'Астрономия в искусстве: картины и фильмы',
          'Практика: анализ астрономических образов в культуре',
          'Философия космоса',
        ],
      };
    }

    // === ЭКОЛОГИЯ ===

    // Экология как наука
    if (lowerTopicName.includes('экология как наука') || lowerTopicName.includes('объект, предмет, методы') || lowerTopicName.includes('уровни организации живого')) {
      return {
        count: 7,
        names: [
          'Что изучает экология: взаимоотношения организмов и среды',
          'Объект экологии: живые организмы',
          'Предмет экологии: взаимодействие с окружающей средой',
          'Методы экологии: наблюдение, эксперимент, моделирование',
          'Уровни организации живого: организм, популяция, экосистема',
          'Практика: проведение экологического исследования',
          'Экология и другие науки',
        ],
      };
    }

    // Биосфера
    if (lowerTopicName.includes('биосфера и её границы') || lowerTopicName.includes('живое вещество') || lowerTopicName.includes('круговороты веществ')) {
      return {
        count: 7,
        names: [
          'Биосфера: оболочка жизни на Земле',
          'Границы биосферы: где есть жизнь',
          'Живое вещество: масса всех организмов',
          'Круговорот углерода: от атмосферы к организмам',
          'Круговорот азота: фиксация и разложение',
          'Потоки энергии: от Солнца к организмам',
          'Практика: анализ круговоротов веществ',
        ],
      };
    }

    // Экосистема
    if (lowerTopicName.includes('экосистема: компоненты') || lowerTopicName.includes('пищевая цепь') || lowerTopicName.includes('трофические уровни')) {
      return {
        count: 7,
        names: [
          'Компоненты экосистемы: продуценты, консументы, редуценты',
          'Пищевая цепь: кто кого ест',
          'Трофические уровни: производители, потребители, разрушители',
          'Пирамида энергии: передача энергии',
          'Пирамида биомассы: накопление вещества',
          'Практика: построение пищевой цепи',
          'Устойчивость экосистемы',
        ],
      };
    }

    // Популяция и биоценоз
    if (lowerTopicName.includes('популяция и биоценоз') || lowerTopicName.includes('численность, плотность') || lowerTopicName.includes('видовые взаимоотношения')) {
      return {
        count: 7,
        names: [
          'Популяция: группа особей одного вида',
          'Численность популяции: сколько особей',
          'Плотность популяции: особей на единицу площади',
          'Конкуренция: борьба за ресурсы',
          'Симбиоз: взаимовыгодное сожительство',
          'Хищник–жертва: пищевые отношения',
          'Практика: изучение популяции',
        ],
      };
    }

    // Биомы Земли
    if (lowerTopicName.includes('биомы земли') || lowerTopicName.includes('леса, степи, пустыни') || lowerTopicName.includes('водные экосистемы')) {
      return {
        count: 8,
        names: [
          'Леса: тропические, умеренные, тайга',
          'Степи: травянистые равнины',
          'Пустыни: засушливые территории',
          'Тундра: холодные равнины',
          'Горные экосистемы: высотная поясность',
          'Водные экосистемы: океаны, реки, озёра',
          'Практика: характеристика биома',
          'Охрана биомов',
        ],
      };
    }

    // Природные ресурсы
    if (lowerTopicName.includes('природные ресурсы') || lowerTopicName.includes('возобновимые и невозобновимые') || lowerTopicName.includes('рациональное природопользование')) {
      return {
        count: 6,
        names: [
          'Возобновимые ресурсы: лес, вода, почва',
          'Невозобновимые ресурсы: нефть, газ, руды',
          'Рациональное природопользование: эффективное использование',
          'Исчерпаемость ресурсов: проблема истощения',
          'Практика: анализ использования ресурсов',
          'Устойчивое использование ресурсов',
        ],
      };
    }

    // Антропогенное воздействие
    if (lowerTopicName.includes('антропогенное воздействие') || lowerTopicName.includes('виды и масштабы влияния')) {
      return {
        count: 6,
        names: [
          'Виды воздействия: прямое и косвенное',
          'Масштабы влияния: локальное и глобальное',
          'Вырубка лесов: влияние на экосистемы',
          'Распашка земель: изменение ландшафтов',
          'Практика: оценка антропогенного воздействия',
          'Снижение негативного влияния',
        ],
      };
    }

    // Загрязнение атмосферы
    if (lowerTopicName.includes('загрязнение атмосферы') || lowerTopicName.includes('смоги') || lowerTopicName.includes('кислотные дожди') || lowerTopicName.includes('озоновый слой')) {
      return {
        count: 7,
        names: [
          'Источники загрязнения: промышленность, транспорт',
          'Смоги: загрязнение воздуха в городах',
          'Кислотные дожди: влияние на природу',
          'Озоновый слой: защита от ультрафиолета',
          'Озоновые дыры: проблема разрушения',
          'Практика: измерение загрязнения воздуха',
          'Меры защиты атмосферы',
        ],
      };
    }

    // Загрязнение гидросферы
    if (lowerTopicName.includes('загрязнение гидросферы') || lowerTopicName.includes('сточные воды') || lowerTopicName.includes('пластиковый мусор')) {
      return {
        count: 7,
        names: [
          'Сточные воды: промышленные и бытовые',
          'Нефть в океанах: разливы и последствия',
          'Эвтрофикация: цветение водоёмов',
          'Пластиковый мусор: проблема океанов',
          'Влияние на водные экосистемы',
          'Практика: анализ загрязнения воды',
          'Очистка и охрана вод',
        ],
      };
    }

    // Загрязнение литосферы
    if (lowerTopicName.includes('загрязнение литосферы') || lowerTopicName.includes('свалки') || lowerTopicName.includes('тяжёлые металлы')) {
      return {
        count: 6,
        names: [
          'Свалки: проблема отходов',
          'Агрохимикаты: удобрения и пестициды',
          'Тяжёлые металлы: загрязнение почв',
          'Влияние на почвы и растения',
          'Практика: оценка загрязнения почв',
          'Рекультивация загрязнённых земель',
        ],
      };
    }

    // Промышленные и бытовые отходы
    if (lowerTopicName.includes('промышленные и бытовые отходы') || lowerTopicName.includes('переработка') || lowerTopicName.includes('раздельный сбор')) {
      return {
        count: 7,
        names: [
          'Классификация отходов: по происхождению и опасности',
          'Переработка: превращение отходов в ресурсы',
          'Раздельный сбор: сортировка мусора',
          'Обращение с опасными отходами: правила',
          'Практика: организация раздельного сбора',
          'Современные технологии переработки',
          'Ноль отходов: концепция',
        ],
      };
    }

    // Радиационное загрязнение
    if (lowerTopicName.includes('радиационное загрязнение') || lowerTopicName.includes('последствия для живых организмов')) {
      return {
        count: 6,
        names: [
          'Источники радиации: природные и техногенные',
          'Радиоактивные вещества: что это такое',
          'Влияние на живые организмы: мутации',
          'Аварии: Чернобыль, Фукусима',
          'Практика: измерение радиационного фона',
          'Защита от радиации',
        ],
      };
    }

    // Глобальные экологические проблемы
    if (lowerTopicName.includes('глобальные экологические проблемы') || lowerTopicName.includes('изменение климата') || lowerTopicName.includes('парниковый эффект')) {
      return {
        count: 8,
        names: [
          'Изменение климата: глобальное потепление',
          'Парниковый эффект: роль углекислого газа',
          'Вырубка лесов: потеря зелёных лёгких',
          'Опустынивание: расширение пустынь',
          'Потеря биоразнообразия: исчезновение видов',
          'Практика: анализ глобальных проблем',
          'Международные меры решения',
          'Что может сделать каждый',
        ],
      };
    }

    // Красная книга
    if (lowerTopicName.includes('красная книга') || lowerTopicName.includes('редкие и исчезающие виды')) {
      return {
        count: 6,
        names: [
          'Красная книга: список редких видов',
          'Редкие виды: амурский тигр, снежный барс',
          'Исчезающие виды: причины вымирания',
          'Меры охраны: заповедники, разведение',
          'Практика: изучение видов из Красной книги',
          'Восстановление популяций',
        ],
      };
    }

    // ООПТ
    if (lowerTopicName.includes('особо охраняемые природные территории') || lowerTopicName.includes('заповедники, национальные парки')) {
      return {
        count: 6,
        names: [
          'Заповедники: строгая охрана природы',
          'Национальные парки: охрана и туризм',
          'Заказники: охрана отдельных видов',
          'ООПТ России: Байкальский заповедник, Кроноцкий',
          'Практика: создание проекта ООПТ',
          'Роль ООПТ в охране природы',
        ],
      };
    }

    // Урбанизация и городская среда
    if (lowerTopicName.includes('урбанизация и городская среда') || lowerTopicName.includes('городские экосистемы') || lowerTopicName.includes('шум и световое загрязнение')) {
      return {
        count: 6,
        names: [
          'Городские экосистемы: природа в городе',
          'Зелёные зоны: парки и скверы',
          'Шумовое загрязнение: влияние на здоровье',
          'Световое загрязнение: проблема ночного неба',
          'Практика: оценка городской среды',
          'Создание экологичных городов',
        ],
      };
    }

    // Экология человека
    if (lowerTopicName.includes('экология человека') || lowerTopicName.includes('влияние факторов среды на здоровье') || lowerTopicName.includes('экологически обусловленные заболевания')) {
      return {
        count: 6,
        names: [
          'Влияние факторов среды: воздух, вода, пища',
          'Экологически обусловленные заболевания: астма, аллергии',
          'Качество жизни: связь с экологией',
          'Здоровье и окружающая среда',
          'Практика: оценка экологических факторов',
          'Профилактика экологических заболеваний',
        ],
      };
    }

    // Экологическая безопасность
    if (lowerTopicName.includes('экологическая безопасность') || lowerTopicName.includes('оценка риска') || lowerTopicName.includes('аварии и катастрофы')) {
      return {
        count: 6,
        names: [
          'Оценка риска: вероятность опасности',
          'Аварии: разливы нефти, выбросы',
          'Катастрофы: крупные экологические бедствия',
          'Правила поведения при загрязнении',
          'Практика: разработка плана безопасности',
          'Системы раннего предупреждения',
        ],
      };
    }

    // Экологическая политика
    if (lowerTopicName.includes('экологическая политика') || lowerTopicName.includes('законодательство') || lowerTopicName.includes('права и обязанности граждан')) {
      return {
        count: 6,
        names: [
          'Основные принципы охраны окружающей среды',
          'Экологическое законодательство: законы и нормы',
          'Права граждан: на благоприятную среду',
          'Обязанности граждан: охрана природы',
          'Практика: анализ экологического законодательства',
          'Экологический контроль',
        ],
      };
    }

    // Международное сотрудничество
    if (lowerTopicName.includes('международное сотрудничество') || lowerTopicName.includes('глобальные соглашения') || lowerTopicName.includes('экологические организации')) {
      return {
        count: 6,
        names: [
          'Глобальные соглашения: Киотский протокол, Парижское соглашение',
          'Экологические организации: Гринпис, WWF',
          'Международные программы: охрана природы',
          'Сотрудничество стран: совместные проекты',
          'Практика: анализ международных соглашений',
          'Роль России в международном сотрудничестве',
        ],
      };
    }

    // Устойчивое развитие
    if (lowerTopicName.includes('концепция устойчивого развития') || lowerTopicName.includes('баланс экономики, общества и природы')) {
      return {
        count: 6,
        names: [
          'Устойчивое развитие: что это такое',
          'Баланс экономики: развитие без ущерба',
          'Баланс общества: справедливость',
          'Баланс природы: сохранение ресурсов',
          'Практика: создание проекта устойчивого развития',
          'Цели устойчивого развития ООН',
        ],
      };
    }

    // Экологическая культура
    if (lowerTopicName.includes('экологическая культура') || lowerTopicName.includes('этика') || lowerTopicName.includes('отношение к животным')) {
      return {
        count: 6,
        names: [
          'Экологическая культура: бережное отношение',
          'Этика: моральные принципы',
          'Отношение к животным: забота и защита',
          'Отношение к растениям: сохранение',
          'Отношение к природным объектам: уважение',
          'Практика: формирование экологической культуры',
        ],
      };
    }

    // Экологичный образ жизни
    if (lowerTopicName.includes('экологичный образ жизни') || lowerTopicName.includes('энерго- и ресурсосбережение') || lowerTopicName.includes('зелёный быт')) {
      return {
        count: 6,
        names: [
          'Энергосбережение: экономия электричества',
          'Ресурсосбережение: экономия воды и материалов',
          'Ответственное потребление: что и как покупать',
          'Зелёный быт: экологичные привычки',
          'Практика: создание плана экологичного образа жизни',
          'Влияние личного выбора на природу',
        ],
      };
    }

    // Экопросвещение
    if (lowerTopicName.includes('экопросвещение') || lowerTopicName.includes('экодобровольчество') || lowerTopicName.includes('акции, волонтёрство')) {
      return {
        count: 6,
        names: [
          'Экопросвещение: распространение знаний',
          'Экологические акции: уборка, посадка деревьев',
          'Волонтёрство: помощь природе',
          'Экологические проекты: школьные инициативы',
          'Практика: организация экологической акции',
          'Влияние просвещения на общество',
        ],
      };
    }

    // Экологический мониторинг
    if (lowerTopicName.includes('экологический мониторинг') || lowerTopicName.includes('наблюдение, измерения') || lowerTopicName.includes('анализ состояния')) {
      return {
        count: 6,
        names: [
          'Экологический мониторинг: постоянное наблюдение',
          'Наблюдение: что смотреть',
          'Измерения: приборы и методы',
          'Анализ состояния: оценка качества среды',
          'Практика: проведение мониторинга',
          'Использование данных мониторинга',
        ],
      };
    }

    // Исследовательские проекты
    if (lowerTopicName.includes('исследовательские и учебные проекты') || lowerTopicName.includes('локальные экологические проблемы') || lowerTopicName.includes('экологический аудит')) {
      return {
        count: 6,
        names: [
          'Локальные экологические проблемы: что вокруг нас',
          'Школьный экологический аудит: оценка школы',
          'Создание памяток: как помочь природе',
          'Рекомендации: что можно улучшить',
          'Практика: выполнение экологического проекта',
          'Защита проекта',
        ],
      };
    }

    // По умолчанию для остальных тем (5 уроков)
    return {
      count: 5,
      names: [
        `Введение в тему: ${topicName.length > 40 ? topicName.substring(0, 37) + '...' : topicName}`,
        'Основные понятия и определения',
        'Правила и закономерности',
        'Практические примеры и упражнения',
        'Итоговое закрепление материала',
      ],
    };
  }

  public async up(queryRunner: QueryRunner): Promise<void> {
    console.log('🌍 Начинаю добавление уроков для дисциплин "Науки о Земле и космосе"...');

    // Проверяем существование таблицы lessons
    const tableExists = await queryRunner.query(`
      SELECT 1 FROM information_schema.tables 
      WHERE table_schema = 'public' AND table_name = 'lessons'
    `);

    if (!(Array.isArray(tableExists) && tableExists.length > 0)) {
      throw new Error('Table lessons does not exist');
    }

    // Проверяем существование колонок
    const isVerifiedExists = await queryRunner.query(`
      SELECT 1 FROM information_schema.columns 
      WHERE table_schema = 'public' 
      AND table_name = 'lessons' 
      AND column_name = 'IsVerified'
    `);

    if (!(Array.isArray(isVerifiedExists) && isVerifiedExists.length > 0)) {
      throw new Error('Column IsVerified does not exist. Please run migration 1763600000000-AddFieldsToLessons first.');
    }

    // Получаем максимальный ID уроков
    const maxIdResult = await queryRunner.query(`
      SELECT COALESCE(MAX("ID"), 0) as max_id FROM "lessons"
    `);
    const maxLessonId = parseInt(maxIdResult[0]?.max_id || '0', 10);
    let nextLessonId = maxLessonId + 1;

    // Получаем все темы для дисциплин "Науки о Земле и космосе"
    const disciplines = [
      'f7b6d5c4-0a3c-4d9e-8b2f-4c3d5e6f7a8b', // География
      'a0c9e8d7-3b6d-4462-9b5a-7d6e8f9a0b1c', // Астрономия
      'f9b8d7c6-2a5c-4351-8b4f-6c5d7e8f9a0b', // Экология
    ];

    // Используем простой запрос без параметров для TypeORM
    const disciplinesStr = disciplines.map(d => `'${d}'`).join(', ');
    const topicsResult = await queryRunner.query(`
      SELECT "TopicID", "TopicName", "DisciplineID"
      FROM "topics"
      WHERE "DisciplineID" IN (${disciplinesStr})
      ORDER BY "DisciplineID", "ID"
    `);

    if (!Array.isArray(topicsResult) || topicsResult.length === 0) {
      console.log('⚠️  Темы для дисциплин "Науки о Земле и космосе" не найдены');
      return;
    }

    console.log(`📝 Найдено ${topicsResult.length} тем для обработки`);

    // Проверяем, есть ли уже уроки для этих тем
    const topicIds = topicsResult.map(t => t.TopicID);
    if (topicIds.length === 0) {
      console.log('⚠️  Темы не найдены');
      return;
    }
    
    const topicIdsStr = topicIds.map(id => `'${id}'`).join(', ');
    const existingLessons = await queryRunner.query(`
      SELECT COUNT(*) as count FROM "lessons"
      WHERE "TopicID" IN (${topicIdsStr})
    `);

    const existingCount = parseInt(existingLessons[0]?.count || '0', 10);
    if (existingCount > 0) {
      console.log(`⚠️  Для некоторых тем уже существуют ${existingCount} уроков. Пропускаем создание дубликатов (используется ON CONFLICT DO NOTHING).`);
      // Продолжаем выполнение - ON CONFLICT DO NOTHING пропустит существующие уроки
    }

    // Генерируем уроки для каждой темы
    const allLessons: Array<{
      LessonID: string;
      ID: number;
      LessonName: string;
      TopicID: string;
      IsVerified: boolean;
      Order: number;
      Description: string | null;
      CreatedAt: Date;
      UpdatedAt: Date;
    }> = [];

    for (const topic of topicsResult) {
      const lessonPlan = this.getLessonPlanForTopic(topic.TopicName);
      const lessons = this.generateLessonsForTopic(
        topic.TopicID,
        topic.TopicName,
        lessonPlan.count,
        lessonPlan.names,
        nextLessonId,
      );
      allLessons.push(...lessons);
      nextLessonId += lessonPlan.count;
    }

    console.log(`📚 Создано ${allLessons.length} уроков для ${topicsResult.length} тем`);

    // Вставляем уроки батчами по 50 для эффективности
    const batchSize = 50;
    for (let i = 0; i < allLessons.length; i += batchSize) {
      const batch = allLessons.slice(i, i + batchSize);
      
      // Создаем значения для INSERT, используя детерминированный UUID
      const values = batch
        .map(
          (lesson, idx) => {
            // Генерируем детерминированный UUID на основе TopicID и ID урока
            const seed = `${lesson.TopicID}-${lesson.ID}`;
            let hash1 = 0, hash2 = 0, hash3 = 0, hash4 = 0;
            for (let i = 0; i < seed.length; i++) {
              const char = seed.charCodeAt(i);
              hash1 = ((hash1 << 5) - hash1) + char;
              hash2 = ((hash2 << 7) - hash2) + char + i;
              hash3 = ((hash3 << 3) - hash3) + char * 3;
              hash4 = ((hash4 << 11) - hash4) + char * 7;
            }
            // Генерируем части UUID (8-4-4-4-12 символов)
            const h1 = Math.abs(hash1).toString(16).padStart(8, '0').substring(0, 8);
            const h2 = Math.abs(hash2).toString(16).padStart(4, '0').substring(0, 4);
            const h3 = Math.abs(hash3).toString(16).padStart(3, '0').substring(0, 3);
            const h4 = (Math.abs(hash1 + hash2) % 4); // 0-3 для выбора 8,9,a,b
            const variant = ['8', '9', 'a', 'b'][h4];
            const h5 = Math.abs(hash3 + hash4).toString(16).padStart(3, '0').substring(0, 3);
            const h6 = Math.abs(hash1 * hash2).toString(16).padStart(12, '0').substring(0, 12);
            const lessonId = `${h1}-${h2}-4${h3}-${variant}${h5}-${h6}`;
            
            return `(
              '${lessonId}',
              ${lesson.ID},
              ${this.escapeString(lesson.LessonName)},
              '${lesson.TopicID}'::uuid,
              ${lesson.IsVerified},
              ${lesson.Order !== null ? lesson.Order : 'NULL'},
              ${lesson.Description ? this.escapeString(lesson.Description) : 'NULL'},
              '${lesson.CreatedAt.toISOString()}'::timestamp,
              '${lesson.UpdatedAt.toISOString()}'::timestamp
            )`;
          }
        )
        .join(',');

      await queryRunner.query(`
        INSERT INTO "lessons" (
          "LessonID", "ID", "LessonName", "TopicID", 
          "IsVerified", "Order", "Description", 
          "CreatedAt", "UpdatedAt"
        )
        VALUES ${values}
        ON CONFLICT ("LessonID") DO NOTHING
      `);
    }

    console.log('✅ Уроки успешно добавлены!');
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    console.log('🔄 Откатываю добавление уроков...');

    // Удаляем уроки для тем дисциплин "Науки о Земле и космосе"
    const disciplines = [
      'f7b6d5c4-0a3c-4d9e-8b2f-4c3d5e6f7a8b', // География
      'a0c9e8d7-3b6d-4462-9b5a-7d6e8f9a0b1c', // Астрономия
      'f9b8d7c6-2a5c-4351-8b4f-6c5d7e8f9a0b', // Экология
    ];

    const disciplinesStr = disciplines.map(d => `'${d}'`).join(', ');
    await queryRunner.query(`
      DELETE FROM "lessons"
      WHERE "TopicID" IN (
        SELECT "TopicID" FROM "topics"
        WHERE "DisciplineID" IN (${disciplinesStr})
      )
    `);

    console.log('✅ Откат завершен');
  }
}

