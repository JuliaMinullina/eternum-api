import { MigrationInterface, QueryRunner } from 'typeorm';

/**
 * –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–º –§–∏–ª–æ—Å–æ—Ñ–∏–∏
 * 
 * –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç —Ç–µ–º—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã:
 * - –¢–µ–∫—É—â–∏–µ —Ç–µ–º—ã –§–∏–ª–æ—Å–æ—Ñ–∏–∏ (–∏–∑ –ü—Å–∏—Ö–æ–ª–æ–≥–∏–∏) -> –≤ –ü—Å–∏—Ö–æ–ª–æ–≥–∏—é
 * - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–µ–º—ã –§–∏–ª–æ—Å–æ—Ñ–∏–∏ (–∏–∑ seed-philosophy-topics.ts) -> –≤ –§–∏–ª–æ—Å–æ—Ñ–∏—é
 */

export class FixPhilosophyTopics1764330000000
  implements MigrationInterface
{
  name = 'FixPhilosophyTopics1764330000000';

  public async up(queryRunner: QueryRunner): Promise<void> {
    console.log('üîß –ò—Å–ø—Ä–∞–≤–ª—è—é —Ç–µ–º—ã –¥–ª—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã "–§–∏–ª–æ—Å–æ—Ñ–∏—è"...');

    const PHILOSOPHY_DISCIPLINE_ID = 'f8a7b6c5-1d4f-5240-3b5f-5c6d7e8f9a0b';
    const PSYCHOLOGY_DISCIPLINE_ID = 'a9b8c7d6-2e5a-5351-4c6a-6d7e8f9a0b1c';

    // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–µ–º—ã –¥–ª—è –§–∏–ª–æ—Å–æ—Ñ–∏–∏ (–∏–∑ seed-philosophy-topics.ts)
    const correctPhilosophyTopics = [
      'a009c922-2b15-45db-a419-c5dad1bf4098', // –ü—Ä–µ–¥–º–µ—Ç –∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏
      '0cd27dc1-a8b8-4c39-9ed0-6238dc63f235', // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–≥–æ –∑–Ω–∞–Ω–∏—è
      '52897591-7292-4188-a0ea-6fbf6947803a', // –í–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏
      '30b7b820-779a-4e97-bf4a-50241c0d0957', // –î–æ—Å–æ–∫—Ä–∞—Ç–∏–∫–∏
      'db2da59a-8cb7-4323-8b0e-aa185b374d91', // –°–æ–∫—Ä–∞—Ç, –ü–ª–∞—Ç–æ–Ω, –ê—Ä–∏—Å—Ç–æ—Ç–µ–ª—å
      '03faee71-0666-4c9d-aef0-26844e3176ff', // –≠–ª–ª–∏–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è
      '3150d6f7-5c05-4797-a3e2-563bf5b7d973', // –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è
      '2deb7f27-4496-4e6f-85cc-bacd906c5fea', // –§–∏–ª–æ—Å–æ—Ñ–∏—è –í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏—è
      '3f26e80d-264a-4a0b-ab13-9ab18cadaad1', // –§–∏–ª–æ—Å–æ—Ñ–∏—è –ù–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
      '9fc6494f-9bde-4113-99b5-94536af80357', // –ù–µ–º–µ—Ü–∫–∞—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è
      '2f5879f0-7a88-4d9c-9682-a38eb25735f3', // –ú–∞—Ä–∫—Å–∏–∑–º
      '61802eed-96a0-4d82-b2c0-a3de3e6835f8', // –ù–µ–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è
      '2534671e-a024-4c54-ac94-0ce4027e1f66', // –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è
      'ebc29730-a435-470b-976e-20849711cad0', // –°—Ç—Ä—É–∫—Ç—É—Ä–∞–ª–∏–∑–º –∏ –ø–æ—Å—Ç—Å—Ç—Ä—É–∫—Ç—É—Ä–∞–ª–∏–∑–º
      '0a93f0ee-12a5-4db3-b2ae-4fe7a0199c35', // –í–æ—Å—Ç–æ—á–Ω—ã–µ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ —Ç—Ä–∞–¥–∏—Ü–∏–∏
      'ef7a1863-da9e-4d40-b9e4-509ac35dba8b', // –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∞—è –∞–Ω—Ç—Ä–æ–ø–æ–ª–æ–≥–∏—è
      'b416f7b1-4c60-494b-a751-0d1feacb5e27', // –°–æ–∑–Ω–∞–Ω–∏–µ –∏ –±–µ—Å—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ–µ
      '172030ae-e96f-4742-b76a-385a86303de1', // –û–Ω—Ç–æ–ª–æ–≥–∏—è
      '24e4a3ed-f7a5-4425-ab20-0fa92e2fc38c', // –î–∏–∞–ª–µ–∫—Ç–∏–∫–∞, –º–µ—Ç–∞—Ñ–∏–∑–∏–∫–∞
      '4901d42a-8f48-45db-b212-c4712120c101', // –ì–Ω–æ—Å–µ–æ–ª–æ–≥–∏—è
      'dc2b7bcb-15e7-42ff-9301-4667c0dae50b', // –Ø–∑—ã–∫ –∏ –º—ã—à–ª–µ–Ω–∏–µ
      '930faa21-3487-4dd6-ae4c-72e9a6bae55c', // –§–∏–ª–æ—Å–æ—Ñ–∏—è –Ω–∞—É–∫–∏
      '9c31790b-1038-4faa-abf3-199140d6fb3e', // –≠—Ç–∏–∫–∞
      '1b4c868f-7090-4697-8bdb-b472fab32bd0', // –≠—Å—Ç–µ—Ç–∏–∫–∞ –∏ —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è –∏—Å–∫—É—Å—Å—Ç–≤–∞
      'b7426bad-d152-43ac-b94d-9f16952349f2', // –ê–∫—Å–∏–æ–ª–æ–≥–∏—è
      '398042e1-1cc0-40bd-a8ba-a40059d2d9cd', // –°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è
      'd3939649-0a16-4a75-824d-8d638947926b', // –ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è
      'c2fb6ec7-0245-4d3e-985c-85a0011bab49', // –§–∏–ª–æ—Å–æ—Ñ–∏—è –∏—Å—Ç–æ—Ä–∏–∏
      '3ece606d-e8a3-4939-933f-03626754f619', // –§–∏–ª–æ—Å–æ—Ñ–∏—è —Ä–µ–ª–∏–≥–∏–∏
      '2d828b5e-bea3-492e-97f6-e66ad5ac68d5', // –§–∏–ª–æ—Å–æ—Ñ–∏—è —Ç–µ—Ö–Ω–∏–∫–∏
      'c41a4ef2-cc2b-4b7c-ba8e-d5b3bb1cbebc', // –§–∏–ª–æ—Å–æ—Ñ–∏—è –∫—É–ª—å—Ç—É—Ä—ã
      '37781e20-2c13-4936-b417-c598ce61e6c2', // –§–∏–ª–æ—Å–æ—Ñ–∏—è –±—É–¥—É—â–µ–≥–æ
    ];

    // 1. –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ç–µ–º—ã –§–∏–ª–æ—Å–æ—Ñ–∏–∏ (–∫–æ—Ç–æ—Ä—ã–µ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –∏–∑ –ü—Å–∏—Ö–æ–ª–æ–≥–∏–∏) –≤ –ü—Å–∏—Ö–æ–ª–æ–≥–∏—é
    await queryRunner.query(`
      UPDATE "topics"
      SET "DisciplineID" = '${PSYCHOLOGY_DISCIPLINE_ID}'
      WHERE "DisciplineID" = '${PHILOSOPHY_DISCIPLINE_ID}'
      AND "TopicID" NOT IN (${correctPhilosophyTopics.map(id => `'${id}'`).join(', ')})
    `);

    // 2. –ü–µ—Ä–µ–º–µ—â–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–µ–º—ã –§–∏–ª–æ—Å–æ—Ñ–∏–∏ –≤ –§–∏–ª–æ—Å–æ—Ñ–∏—é (–µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –≤ –¥—Ä—É–≥–∏—Ö –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ö)
    await queryRunner.query(`
      UPDATE "topics"
      SET "DisciplineID" = '${PHILOSOPHY_DISCIPLINE_ID}'
      WHERE "TopicID" IN (${correctPhilosophyTopics.map(id => `'${id}'`).join(', ')})
    `);

    console.log('‚úÖ –¢–µ–º—ã –¥–ª—è –§–∏–ª–æ—Å–æ—Ñ–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã');
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    console.log('üîÑ –û—Ç–∫–∞—Ç—ã–≤–∞—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º...');
    // –û—Ç–∫–∞—Ç –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –º—ã –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–º–µ—â–∞–µ–º —Ç–µ–º—ã
    console.log('‚úÖ –û—Ç–∫–∞—Ç –∑–∞–≤–µ—Ä—à–µ–Ω');
  }
}

