import { MigrationInterface, QueryRunner } from 'typeorm';

/**
 * –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–º –ö—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏–∏
 * 
 * –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç —Ç–µ–º—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã:
 * - –¢–µ–∫—É—â–∏–µ —Ç–µ–º—ã –ö—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏–∏ (–∏–∑ –ú–•–ö) -> –≤ –ú–•–ö
 * - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–µ–º—ã –ö—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏–∏ (–∏–∑ seed-culturology-topics.ts) -> –≤ –ö—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏—é
 */

export class FixCulturologyTopics1764350000000
  implements MigrationInterface
{
  name = 'FixCulturologyTopics1764350000000';

  public async up(queryRunner: QueryRunner): Promise<void> {
    console.log('üîß –ò—Å–ø—Ä–∞–≤–ª—è—é —Ç–µ–º—ã –¥–ª—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã "–ö—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏—è"...');

    const CULTUROLOGY_DISCIPLINE_ID = 'e7f6a5b4-0c3e-5139-2a4e-4b5c6d7e8f9a';
    const FINE_ARTS_CULTURE_DISCIPLINE_ID = 'd6e5f4a3-9b2d-5028-1f3d-3a4b5c6d7e8f';

    // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–µ–º—ã –¥–ª—è –ö—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏–∏ (–∏–∑ seed-culturology-topics.ts)
    const correctCulturologyTopics = [
      '44a41d98-b788-416d-954a-3800f463006c', // –ü—Ä–µ–¥–º–µ—Ç, –æ–±—ä–µ–∫—Ç –∏ –º–µ—Ç–æ–¥—ã –∫—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏–∏
      'c363ae6f-8fbb-4e47-b9f8-e96d70d29f14', // –ü–æ–Ω—è—Ç–∏–µ –∫—É–ª—å—Ç—É—Ä—ã
      '1091b6be-18ac-4894-81a1-d251d1f0a3c2', // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—É–ª—å—Ç—É—Ä—ã
      '39ff2152-13cc-48d1-855a-0034c5fe1ef5', // –ö—É–ª—å—Ç—É—Ä–∞ –∏ –ø—Ä–∏—Ä–æ–¥–∞
      '724a14e7-dd27-4265-9bae-0b0deee4bc61', // –§—É–Ω–∫—Ü–∏–∏ –∫—É–ª—å—Ç—É—Ä—ã
      '3d2baed5-88c6-48f8-ad57-91b62d193052', // –ò—Å—Ç–æ—Ä–∏—è –∫—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –º—ã—Å–ª–∏
      '8408d215-6e79-4974-a47d-d93842d4705c', // –û—Å–Ω–æ–≤–Ω—ã–µ –∫—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —à–∫–æ–ª—ã
      '5831bd63-026f-4143-bc0e-c01755246e06', // –°–æ—Ü–∏–æ–∫—É–ª—å—Ç—É—Ä–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞
      '5389072a-c66c-4cde-b7f6-60709154afe5', // –°–æ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –∏–Ω–∫—É–ª—å—Ç—É—Ä–∞—Ü–∏—è
      '1ae3ae0d-8dc2-4a5f-8b68-25c721c07844', // –õ–∏—á–Ω–æ—Å—Ç—å –∏ –∫—É–ª—å—Ç—É—Ä–∞
      '5efa6ee1-04ea-4363-b0ad-efd2b89bf8ac', // –¶–µ–Ω–Ω–æ—Å—Ç–∏, –Ω–æ—Ä–º—ã, —Ç—Ä–∞–¥–∏—Ü–∏–∏
      '47a8f0df-5f77-4973-aca0-07a4f2d666c7', // –ö—É–ª—å—Ç—É—Ä–Ω—ã–µ –∫–æ–¥—ã, —Å–∏–º–≤–æ–ª—ã
      'e4ce1621-2dfa-434d-bb36-8aad42d89c7b', // –Ø–∑—ã–∫, —Ç–µ–∫—Å—Ç –∏ –¥–∏—Å–∫—É—Ä—Å
      '1f6093e8-e949-462b-a7c1-a0cccb4465e8', // –¢–∏–ø–æ–ª–æ–≥–∏—è –∫—É–ª—å—Ç—É—Ä
      '74a52cf7-6ac0-4b1c-9e07-0a211d60c3bf', // –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Ç–∏–ø—ã –∫—É–ª—å—Ç—É—Ä—ã
      '6422bdc9-4ad7-45de-a866-682c72e88e19', // –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏ —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
      '1e34701d-726a-4eff-b0be-14122ce142c0', // –ö—É–ª—å—Ç—É—Ä–∞ –†–æ—Å—Å–∏–∏
      'e6df928f-0c16-4f81-91ea-5ba9290540fb', // –†–µ–ª–∏–≥–∏—è –∏ –º–∏—Ñ
      '3c6e88cb-3e99-46b8-8228-dc5adc793fd0', // –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞
      '1c559167-5fdc-4a5a-8929-cb7b3b71a919', // –ù—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω–∞—è, –ø—Ä–∞–≤–æ–≤–∞—è –∫—É–ª—å—Ç—É—Ä–∞
      '0e43851f-ad42-435b-8bda-583196a0a561', // –ì–æ—Ä–æ–¥—Å–∫–∞—è –∏ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞
      '024dfe05-672e-43a0-8d17-e3043e62e989', // –ú–∞—Å—Å–æ–≤–∞—è –∫—É–ª—å—Ç—É—Ä–∞
      'f449d1f5-9eec-4028-bb40-97c047d43121', // –¶–∏—Ñ—Ä–æ–≤–∞—è –∫—É–ª—å—Ç—É—Ä–∞
      '711aa2a7-17f0-4aa0-a740-41bb9a02307c', // –ö—É–ª—å—Ç—É—Ä–Ω–∞—è –ø–∞–º—è—Ç—å
      '9aa87d4c-642b-4208-aa52-cba1146b84f9', // –ö—É–ª—å—Ç—É—Ä–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞
      'ca551f8b-965f-4320-9573-8ca58eee829a', // –ú–µ–∂–∫—É–ª—å—Ç—É—Ä–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è
      '3e2eda9c-983a-4a12-9e86-215697e8ac92', // –ì–ª–æ–±–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
      '3606578c-b350-4683-83b3-d87f7df771f4', // –ö—É–ª—å—Ç—É—Ä–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
      '6393ff17-022a-4aaa-ac3b-d8609e12266a', // –ö—É–ª—å—Ç—É—Ä–∞, –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –∏ –≤–ª–∞—Å—Ç—å
      'ef5ff523-fb97-4d9e-aae6-ce0a62e9b2be', // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã
    ];

    // 1. –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ç–µ–º—ã –ö—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏–∏ (–∫–æ—Ç–æ—Ä—ã–µ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –∏–∑ –ú–•–ö) –≤ –ú–•–ö
    await queryRunner.query(`
      UPDATE "topics"
      SET "DisciplineID" = '${FINE_ARTS_CULTURE_DISCIPLINE_ID}'
      WHERE "DisciplineID" = '${CULTUROLOGY_DISCIPLINE_ID}'
      AND "TopicID" NOT IN (${correctCulturologyTopics.map(id => `'${id}'`).join(', ')})
    `);

    // 2. –ü–µ—Ä–µ–º–µ—â–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–µ–º—ã –ö—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏–∏ –≤ –ö—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏—é (–µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –≤ –¥—Ä—É–≥–∏—Ö –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ö)
    await queryRunner.query(`
      UPDATE "topics"
      SET "DisciplineID" = '${CULTUROLOGY_DISCIPLINE_ID}'
      WHERE "TopicID" IN (${correctCulturologyTopics.map(id => `'${id}'`).join(', ')})
    `);

    console.log('‚úÖ –¢–µ–º—ã –¥–ª—è –ö—É–ª—å—Ç—É—Ä–æ–ª–æ–≥–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã');
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    console.log('üîÑ –û—Ç–∫–∞—Ç—ã–≤–∞—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º...');
    // –û—Ç–∫–∞—Ç –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –º—ã –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–º–µ—â–∞–µ–º —Ç–µ–º—ã
    console.log('‚úÖ –û—Ç–∫–∞—Ç –∑–∞–≤–µ—Ä—à–µ–Ω');
  }
}

