# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π –≤ production

## –ü—Ä–æ–±–ª–µ–º–∞

–ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∏—Å—å –Ω–∞ production –ø—Ä–∏ –¥–µ–ø–ª–æ–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `typeorm-ts-node-commonjs`, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç TypeScript —Ñ–∞–π–ª—ã
2. –í production –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ `.js` —Ñ–∞–π–ª—ã
3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–∫–∞–∑—ã–≤–∞–ª–∞ –Ω–∞ `src/config/typeorm.config.ts`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ production

## –†–µ—à–µ–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–Ω production –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π

**–§–∞–π–ª:** `src/config/typeorm.config.prod.js`

–≠—Ç–æ—Ç –∫–æ–Ω—Ñ–∏–≥:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—ã—á–Ω—ã–π JavaScript (–Ω–µ TypeScript)
- –£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ `.js` —Ñ–∞–π–ª—ã –≤ `dist/`
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±—ã—á–Ω—ã–º `typeorm` CLI (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç ts-node)

### 2. –î–æ–±–∞–≤–ª–µ–Ω—ã production —Å–∫—Ä–∏–ø—Ç—ã

–í `package.json` –¥–æ–±–∞–≤–ª–µ–Ω—ã:
```json
"typeorm:prod": "typeorm",
"migration:run:prod": "npm run typeorm:prod migration:run -- -d dist/config/typeorm.config.prod.js",
"migration:revert:prod": "npm run typeorm:prod migration:revert -- -d dist/config/typeorm.config.prod.js"
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω start.sh

–¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `migration:run:prod` –≤–º–µ—Å—Ç–æ `migration:run`:
```bash
npm run migration:run:prod
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω Dockerfile.prod

Production –∫–æ–Ω—Ñ–∏–≥ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ `dist/config/` –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏:
```dockerfile
RUN mkdir -p dist/config && \
    cp src/config/typeorm.config.prod.js dist/config/typeorm.config.prod.js
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–∏ —Å–±–æ—Ä–∫–µ:**
   - TypeScript —Ñ–∞–π–ª—ã –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è –≤ `dist/`
   - Production –∫–æ–Ω—Ñ–∏–≥ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ `dist/config/`

2. **–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:**
   - `start.sh` –∑–∞–ø—É—Å–∫–∞–µ—Ç `npm run migration:run:prod`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–π `typeorm` CLI (–Ω–µ ts-node)
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥ –∏–∑ `dist/config/typeorm.config.prod.js`
   - –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∏–∑ `dist/migrations/*.js`

3. **–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π:**
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `npm run start:prod`

## –ü—Ä–æ–≤–µ—Ä–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
npm run build

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ production –∫–æ–Ω—Ñ–∏–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω
ls -la dist/config/typeorm.config.prod.js

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã
ls -la dist/migrations/*.js
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ production

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ CapRover:
```bash
# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
üîÑ Running migrations...
‚úÖ Migrations completed (or skipped)
üöÄ Starting application...
```

–ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –ß—Ç–æ `typeorm` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ dependencies (–Ω–µ —Ç–æ–ª—å–∫–æ –≤ devDependencies)
2. –ß—Ç–æ production –∫–æ–Ω—Ñ–∏–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ `dist/config/`
3. –ß—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π –≤ production

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é:

```bash
# –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
cd /app
npm run migration:run:prod
```

## –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π

```bash
npm run migration:revert:prod
```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **TypeORM CLI –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ dependencies**, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≤ devDependencies
2. **Production –∫–æ–Ω—Ñ–∏–≥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—ã—á–Ω—ã–π JavaScript**, –Ω–µ TypeScript
3. **–ü—É—Ç–∏ –≤ –∫–æ–Ω—Ñ–∏–≥–µ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ `dist/`**, –Ω–µ –Ω–∞ `src/`
4. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã** –≤ `.js` —Ñ–∞–π–ª—ã

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
Backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ typeorm.config.ts          # –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (TypeScript)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ typeorm.config.prod.js     # –î–ª—è production (JavaScript)
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ       ‚îî‚îÄ‚îÄ *.ts                        # –ò—Å—Ö–æ–¥–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ dist/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ typeorm.config.prod.js     # –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ production
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ       ‚îî‚îÄ‚îÄ *.js                        # –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ start.sh                            # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
‚îî‚îÄ‚îÄ Dockerfile.prod                     # Docker –æ–±—Ä–∞–∑ –¥–ª—è production
```

