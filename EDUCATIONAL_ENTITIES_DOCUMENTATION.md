# Документация образовательных сущностей

## Обзор

Система образовательных сущностей состоит из четырех основных компонентов:
- **Discipline** (Дисциплина) - основная учебная дисциплина
- **Topic** (Тема) - темы, входящие в дисциплину
- **Lesson** (Урок) - уроки, входящие в тему
- **ViewHistory** (История просмотров) - отслеживание активности пользователей

## Структура сущностей

### 1. Discipline (Дисциплина)

**Таблица:** `disciplines`

**Атрибуты:**
- `DisciplineID` (Primary Key, UUID) - уникальный идентификатор дисциплины
- `DisciplineName` (string, 255) - название дисциплины
- `CreatedAt` (timestamp) - дата создания
- `UpdatedAt` (timestamp) - дата последнего обновления

**Связи:**
- `OneToMany` с `Topic` - одна дисциплина содержит много тем

### 2. Topic (Тема)

**Таблица:** `topics`

**Атрибуты:**
- `TopicID` (Primary Key, UUID) - уникальный идентификатор темы
- `TopicName` (string, 255) - название темы
- `DisciplineID` (Foreign Key, UUID) - ссылка на дисциплину
- `CreatedAt` (timestamp) - дата создания
- `UpdatedAt` (timestamp) - дата последнего обновления

**Связи:**
- `ManyToOne` с `Discipline` - тема принадлежит одной дисциплине
- `OneToMany` с `Lesson` - одна тема содержит много уроков

### 3. Lesson (Урок)

**Таблица:** `lessons`

**Атрибуты:**
- `LessonID` (Primary Key, UUID) - уникальный идентификатор урока
- `LessonName` (string, 255) - название урока
- `TopicID` (Foreign Key, UUID) - ссылка на тему
- `CreatedAt` (timestamp) - дата создания
- `UpdatedAt` (timestamp) - дата последнего обновления

**Связи:**
- `ManyToOne` с `Topic` - урок принадлежит одной теме

### 4. ViewHistory (История просмотров)

**Таблица:** `view_history`

**Атрибуты:**
- `ViewHistoryID` (Primary Key, UUID) - уникальный идентификатор записи
- `UserID` (Foreign Key, UUID) - ссылка на пользователя
- `ViewType` (enum) - тип просмотренного контента:
  - `discipline` - просмотр дисциплины
  - `topic` - просмотр темы
  - `lesson` - просмотр урока
- `DisciplineID` (Foreign Key, UUID, nullable) - ссылка на дисциплину
- `TopicID` (Foreign Key, UUID, nullable) - ссылка на тему
- `LessonID` (Foreign Key, UUID, nullable) - ссылка на урок
- `ViewedAt` (timestamp) - время просмотра

**Связи:**
- `ManyToOne` с `User` - запись принадлежит одному пользователю
- `ManyToOne` с `Discipline` (опционально)
- `ManyToOne` с `Topic` (опционально)
- `ManyToOne` с `Lesson` (опционально)

## API Endpoints

### Discipline API

```
GET    /disciplines          - получить все дисциплины
GET    /disciplines/:id      - получить дисциплину по UUID
POST   /disciplines          - создать новую дисциплину
PUT    /disciplines/:id      - обновить дисциплину
DELETE /disciplines/:id      - удалить дисциплину
```

### Topic API

```
GET    /topics               - получить все темы
GET    /topics/:id           - получить тему по UUID
GET    /topics/discipline/:disciplineId - получить темы дисциплины
POST   /topics               - создать новую тему
PUT    /topics/:id           - обновить тему
DELETE /topics/:id           - удалить тему
```

### Lesson API

```
GET    /lessons              - получить все уроки
GET    /lessons/:id          - получить урок по UUID
GET    /lessons/topic/:topicId - получить уроки темы
POST   /lessons              - создать новый урок
PUT    /lessons/:id          - обновить урок
DELETE /lessons/:id          - удалить урок
```

### ViewHistory API

```
POST   /view-history         - создать запись о просмотре
GET    /view-history/my      - получить мою историю просмотров
GET    /view-history/my/recent?limit=10 - получить последние просмотры
GET    /view-history/my/type/:viewType - получить историю по типу
DELETE /view-history/:id     - удалить запись
DELETE /view-history/my/clear - очистить мою историю
```

## Заполнение данными

### Заполнение дисциплин

Для заполнения базы данных предустановленными дисциплинами используйте команду:

```bash
npm run seed:disciplines
```

Этот скрипт создаст 22 дисциплины согласно российскому образовательному стандарту:

1. Русский язык
2. Литература
3. Математика
4. Физика
5. Химия
6. Биология
7. География
8. История
9. Обществознание
10. Информатика и ИКТ
11. Иностранный язык — Английский
12. Иностранный язык — Немецкий
13. Иностранный язык — Французский
14. Технология
15. Изобразительное искусство
16. Музыка
17. Физическая культура
18. Основы безопасности жизнедеятельности
19. Экология
20. Астрономия
21. Экономика
22. Право

### Тестирование API

Для тестирования API дисциплин используйте:

```bash
node test-disciplines.js
```

## Примеры использования

### Создание дисциплины

```bash
curl -X POST http://localhost:3000/disciplines \
  -H "Content-Type: application/json" \
  -d '{
    "DisciplineName": "Новая дисциплина"
  }'
```

### Создание темы

```bash
curl -X POST http://localhost:3000/topics \
  -H "Content-Type: application/json" \
  -d '{
    "TopicName": "Новая тема",
    "DisciplineID": "6b1f9d2a-3c4e-4f6a-9b2d-1e0f2a3b4c5d"
  }'
```

### Создание урока

```bash
curl -X POST http://localhost:3000/lessons \
  -H "Content-Type: application/json" \
  -d '{
    "LessonName": "Новый урок",
    "TopicID": "uuid-темы"
  }'
```

### Запись просмотра

```bash
curl -X POST http://localhost:3000/view-history \
  -H "Content-Type: application/json" \
  -d '{
    "ViewType": "lesson",
    "LessonID": "uuid-урока"
  }'
```

## Особенности реализации

### UUID идентификаторы

Все сущности используют UUID в качестве первичных ключей:
- Обеспечивает уникальность без централизованного генератора
- Безопасность - сложно угадать ID других записей
- Возможность генерации ID на клиенте
- Совместимость с распределенными системами

### Иерархическая структура

```
Discipline (Дисциплина)
├── Topic (Тема)
│   ├── Lesson (Урок)
│   └── Lesson (Урок)
└── Topic (Тема)
    ├── Lesson (Урок)
    └── Lesson (Урок)
```

### История просмотров

Система отслеживает активность пользователей на всех уровнях:
- Просмотр дисциплины
- Просмотр темы
- Просмотр урока

Это позволяет:
- Анализировать популярность контента
- Рекомендовать пользователям релевантные материалы
- Отслеживать прогресс обучения

### Безопасность

Все API endpoints защищены JWT аутентификацией. Пользователи могут:
- Просматривать только свою историю просмотров
- Создавать записи только от своего имени
- Удалять только свои записи

### Валидация

Все DTO содержат валидацию:
- Обязательные поля
- Минимальная длина строк
- Корректность UUID
- Существование связанных сущностей

## Миграция данных

При изменении структуры базы данных:

1. Остановите приложение
2. Удалите существующие таблицы (если необходимо)
3. Перезапустите приложение для создания новых таблиц
4. Запустите скрипт заполнения: `npm run seed:disciplines`

## Мониторинг и логирование

Система включает:
- Логирование всех операций с базой данных
- Отслеживание времени выполнения запросов
- Мониторинг ошибок валидации
- Логирование действий пользователей
