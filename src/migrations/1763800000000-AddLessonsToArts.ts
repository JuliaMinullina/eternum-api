import { MigrationInterface, QueryRunner } from 'typeorm';

/**
 * Миграция для добавления уроков ко всем темам дисциплин "Искусство"
 * 
 * Дисциплины:
 * - Изобразительное искусство
 * - Музыка
 * - Мировая художественная культура
 * 
 * Для каждой темы создается от 4 до 10 уроков с конкретными названиями.
 */

export class AddLessonsToArts1763800000000
  implements MigrationInterface
{
  name = 'AddLessonsToArts1763800000000';

  /**
   * Экранирует строку для SQL
   */
  private escapeString(str: string): string {
    return `'${str.replace(/'/g, "''")}'`;
  }

  /**
   * Генерирует уроки для темы
   */
  private generateLessonsForTopic(
    topicId: string,
    topicName: string,
    lessonCount: number,
    lessonNames: string[],
    startLessonId: number,
  ): Array<{
    LessonID: string;
    ID: number;
    LessonName: string;
    TopicID: string;
    IsVerified: boolean;
    Order: number;
    Description: string | null;
    CreatedAt: Date;
    UpdatedAt: Date;
  }> {
    const lessons: Array<{
      LessonID: string;
      ID: number;
      LessonName: string;
      TopicID: string;
      IsVerified: boolean;
      Order: number;
      Description: string | null;
      CreatedAt: Date;
      UpdatedAt: Date;
    }> = [];
    const baseDate = new Date('2025-08-16T12:00:00Z');

    for (let i = 0; i < lessonCount; i++) {
      const tempId = `temp-${topicId}-${startLessonId + i}`;
      lessons.push({
        LessonID: tempId,
        ID: startLessonId + i,
        LessonName: lessonNames[i] || `Урок ${i + 1}: ${topicName}`,
        TopicID: topicId,
        IsVerified: false,
        Order: i + 1,
        Description: null,
        CreatedAt: baseDate,
        UpdatedAt: baseDate,
      });
    }

    return lessons;
  }

  /**
   * Получает план уроков для темы на основе её названия
   * Названия уроков сделаны конкретными, не абстрактными
   */
  private getLessonPlanForTopic(topicName: string): {
    count: number;
    names: string[];
  } {
    const lowerTopicName = topicName.toLowerCase();

    // === ИЗОБРАЗИТЕЛЬНОЕ ИСКУССТВО ===

    // Роль искусства в жизни
    if (lowerTopicName.includes('изобразительное искусство в жизни') || lowerTopicName.includes('роль художественного труда')) {
      return {
        count: 5,
        names: [
          'Что такое изобразительное искусство и зачем оно нужно',
          'Как искусство влияет на нашу повседневную жизнь',
          'Художественный труд: от идеи до произведения',
          'Примеры использования искусства в современном мире',
          'Практика: создание собственного художественного проекта',
        ],
      };
    }

    // Виды изобразительного искусства
    if (lowerTopicName.includes('виды изобразительного искусства')) {
      return {
        count: 8,
        names: [
          'Живопись: краски, кисти и холст',
          'Графика: карандаш, тушь и перо',
          'Скульптура: работа с объёмом и формой',
          'Декоративно-прикладное искусство: от росписи до вышивки',
          'Дизайн: создание функциональной красоты',
          'Архитектура: искусство строить здания',
          'Экранные визуальные искусства: кино и анимация',
          'Практика: определение вида искусства по произведению',
        ],
      };
    }

    // Художественный образ и язык искусства
    if (lowerTopicName.includes('художественный образ') || lowerTopicName.includes('язык искусства')) {
      return {
        count: 9,
        names: [
          'Точка, линия и пятно: основы графики',
          'Силуэт и форма: как создать узнаваемый образ',
          'Объём и пространство: передача глубины',
          'Ритм в композиции: повторение и движение',
          'Пропорции: правильные соотношения размеров',
          'Композиция: размещение элементов на листе',
          'Практика: анализ композиции известных картин',
          'Создание собственной композиции',
          'Защита творческой работы',
        ],
      };
    }

    // Цвет и свет
    if (lowerTopicName.includes('цвет и свет') || lowerTopicName.includes('цветовой круг')) {
      return {
        count: 7,
        names: [
          'Цветовой круг: основные и составные цвета',
          'Тёплые и холодные цвета: как создать настроение',
          'Цветовые контрасты: яркое и приглушённое',
          'Тон и колорит: гармония цветов в картине',
          'Светотень: как свет создаёт объём',
          'Практика: работа с акварелью и гуашью',
          'Создание картины с выразительным колоритом',
        ],
      };
    }

    // Материалы и техники
    if (lowerTopicName.includes('материалы и техники') || lowerTopicName.includes('карандаш, тушь')) {
      return {
        count: 8,
        names: [
          'Карандаш: от простого к сложному',
          'Тушь и перо: техника штриховки',
          'Уголь и пастель: мягкие материалы',
          'Акварель: прозрачность и лёгкость',
          'Гуашь: плотные и яркие краски',
          'Смешанные техники: комбинирование материалов',
          'Правила работы и техника безопасности',
          'Практика: создание работы в разных техниках',
        ],
      };
    }

    // Рисунок с натуры
    if (lowerTopicName.includes('рисунок с натуры') || lowerTopicName.includes('геометрические тела')) {
      return {
        count: 6,
        names: [
          'Геометрические тела: куб, шар, цилиндр',
          'Бытовые предметы: чашка, ваза, книга',
          'Учебный натюрморт: составление композиции',
          'Пропорции: как правильно измерить предмет',
          'Конструкция формы: построение объёма',
          'Передача объёма светотенью',
        ],
      };
    }

    // Натюрморт
    if (lowerTopicName.includes('натюрморт')) {
      return {
        count: 6,
        names: [
          'Композиция натюрморта: выбор предметов и их расположение',
          'Передача фактуры: гладкое, шершавое, блестящее',
          'Материал предметов: стекло, металл, ткань',
          'Освещение: как свет создаёт настроение',
          'Настроение в натюрморте: радость, грусть, спокойствие',
          'Практика: создание собственного натюрморта',
        ],
      };
    }

    // Пейзаж
    if (lowerTopicName.includes('пейзаж')) {
      return {
        count: 6,
        names: [
          'Природный пейзаж: деревья, горы, вода',
          'Городской пейзаж: улицы, здания, мосты',
          'Плановость: передний, средний, дальний план',
          'Воздушная перспектива: как передать расстояние',
          'Состояние погоды: солнце, дождь, туман',
          'Практика: рисование пейзажа с натуры',
        ],
      };
    }

    // Портрет и фигура человека
    if (lowerTopicName.includes('портрет') || lowerTopicName.includes('фигура человека')) {
      return {
        count: 7,
        names: [
          'Пропорции головы: основные правила',
          'Пропорции тела: соотношение частей',
          'Характер в портрете: передача индивидуальности',
          'Мимика: выражение эмоций на лице',
          'Поза: как положение тела рассказывает историю',
          'Практика: рисование портрета с натуры',
          'Создание автопортрета',
        ],
      };
    }

    // Анималистика
    if (lowerTopicName.includes('анималистика') || lowerTopicName.includes('изображение животных')) {
      return {
        count: 5,
        names: [
          'Анатомия животных: строение тела',
          'Передача движения: бег, прыжок, полёт',
          'Пластика: гибкость и грация',
          'Шерсть, перья, чешуя: передача фактуры',
          'Практика: рисование любимого животного',
        ],
      };
    }

    // Жанровая композиция
    if (lowerTopicName.includes('жанровая композиция') || lowerTopicName.includes('люди в быту')) {
      return {
        count: 6,
        names: [
          'Выбор сюжета: что интересно изобразить',
          'Момент действия: запечатление движения',
          'Люди в быту: домашние сцены',
          'Люди в труде: работа и профессии',
          'Композиция с несколькими фигурами',
          'Практика: создание жанровой композиции',
        ],
      };
    }

    // Перспектива
    if (lowerTopicName.includes('перспектива') || lowerTopicName.includes('линия горизонта')) {
      return {
        count: 6,
        names: [
          'Линия горизонта: где она находится',
          'Точка схода: как предметы уменьшаются вдаль',
          'Уменьшение предметов: правила перспективы',
          'Перекрытие форм: что ближе, что дальше',
          'Практика: рисование комнаты в перспективе',
          'Создание городской улицы с перспективой',
        ],
      };
    }

    // Декоративная композиция
    if (lowerTopicName.includes('декоративная композиция') || lowerTopicName.includes('стилизация')) {
      return {
        count: 6,
        names: [
          'Стилизация формы: упрощение и обобщение',
          'Орнамент: повторяющиеся элементы',
          'Ритм в декоративной композиции',
          'Симметрия и асимметрия: баланс в композиции',
          'Декоративный цвет: яркость и контраст',
          'Практика: создание декоративной композиции',
        ],
      };
    }

    // Народное искусство
    if (lowerTopicName.includes('народное') || lowerTopicName.includes('декоративно-прикладное искусство народов')) {
      return {
        count: 7,
        names: [
          'Росписи: хохлома, гжель, городец',
          'Резьба по дереву: традиционные узоры',
          'Вышивка: народные орнаменты',
          'Народная игрушка: дымка, филимоновская',
          'Народный костюм: элементы и украшения',
          'Использование народных мотивов в своих работах',
          'Практика: создание работы в народном стиле',
        ],
      };
    }

    // Символ и знак
    if (lowerTopicName.includes('символ и знак') || lowerTopicName.includes('гербы, эмблемы')) {
      return {
        count: 5,
        names: [
          'Гербы: история и значение символов',
          'Эмблемы: как создать узнаваемый знак',
          'Условные изображения: пиктограммы и иконки',
          'Символика в искусстве: скрытые смыслы',
          'Практика: создание собственной эмблемы',
        ],
      };
    }

    // Архитектура
    if (lowerTopicName.includes('архитектура') || lowerTopicName.includes('форма здания')) {
      return {
        count: 6,
        names: [
          'Форма здания: от простого к сложному',
          'Силуэт города: узнаваемые очертания',
          'Интерьер: внутреннее пространство',
          'Садово-парковое искусство: ландшафтный дизайн',
          'Практика: проектирование собственного здания',
          'Создание макета архитектурного объекта',
        ],
      };
    }

    // Дизайн
    if (lowerTopicName.includes('основы дизайна') || lowerTopicName.includes('дизайн предметов')) {
      return {
        count: 7,
        names: [
          'Дизайн предметов: форма и функция',
          'Дизайн одежды: мода и стиль',
          'Графический дизайн: плакат и реклама',
          'Логотип: создание фирменного знака',
          'Упаковка: привлекательный дизайн',
          'Практика: разработка дизайна упаковки',
          'Защита дизайн-проекта',
        ],
      };
    }

    // Книжная иллюстрация
    if (lowerTopicName.includes('книжная иллюстрация') || lowerTopicName.includes('иллюстрирование текста')) {
      return {
        count: 6,
        names: [
          'Иллюстрирование текста: как передать сюжет',
          'Титульный лист: первое впечатление',
          'Макет страницы: расположение текста и рисунков',
          'Декоративный шрифт: буквы как искусство',
          'Практика: иллюстрация к любимой сказке',
          'Создание собственной книжки-картинки',
        ],
      };
    }

    // Театр и кино
    if (lowerTopicName.includes('театр, кино') || lowerTopicName.includes('декорации, костюм')) {
      return {
        count: 6,
        names: [
          'Декорации: создание сценического пространства',
          'Костюм: образ персонажа',
          'Грим: превращение актёра',
          'Афиша: приглашение на спектакль',
          'Кадр в кино: композиция и ракурс',
          'Практика: создание эскиза декорации',
        ],
      };
    }

    // Восприятие и анализ
    if (lowerTopicName.includes('восприятие и анализ') || lowerTopicName.includes('анализ произведений')) {
      return {
        count: 7,
        names: [
          'Тема произведения: о чём картина',
          'Сюжет: что происходит на картине',
          'Композиция: как расположены элементы',
          'Цвет и свет: создание настроения',
          'Настроение: какие эмоции вызывает',
          'Собственное мнение: как оценить произведение',
          'Практика: анализ картины известного художника',
        ],
      };
    }

    // Искусство родного края
    if (lowerTopicName.includes('искусство родного края') || lowerTopicName.includes('местные художники')) {
      return {
        count: 5,
        names: [
          'Местные художники: знакомство с творчеством',
          'Архитектура региона: знаменитые здания',
          'Музеи и выставки: культурное наследие',
          'Практика: посещение музея или выставки',
          'Создание проекта о местном искусстве',
        ],
      };
    }

    // Современные визуальные практики
    if (lowerTopicName.includes('современные визуальные практики') || lowerTopicName.includes('фотография, плакат')) {
      return {
        count: 7,
        names: [
          'Фотография: композиция и ракурс',
          'Плакат: призыв к действию',
          'Комикс: рассказ в картинках',
          'Цифровая графика: работа на компьютере',
          'Анимация: оживление рисунка',
          'Практика: создание комикса',
          'Защита цифрового проекта',
        ],
      };
    }

    // Организация художественной деятельности
    if (lowerTopicName.includes('организация художественной деятельности') || lowerTopicName.includes('эскиз, выбор материалов')) {
      return {
        count: 6,
        names: [
          'Эскиз: подготовка к работе',
          'Выбор материалов: что подходит для идеи',
          'Выполнение: от эскиза к готовой работе',
          'Оформление: как представить работу',
          'Участие в выставке: подготовка к показу',
          'Защита творческого проекта',
        ],
      };
    }

    // Личная творческая практика
    if (lowerTopicName.includes('личная творческая практика') || lowerTopicName.includes('портфолио')) {
      return {
        count: 5,
        names: [
          'Серия работ: развитие темы',
          'Развитие авторского стиля: поиск своего языка',
          'Самооценка: анализ своих работ',
          'Рефлексия: что получилось, что улучшить',
          'Создание портфолио: отбор лучших работ',
        ],
      };
    }

    // === МУЗЫКА ===

    // Музыка как вид искусства
    if (lowerTopicName.includes('музыка как вид искусства') || lowerTopicName.includes('роль в жизни человека')) {
      return {
        count: 5,
        names: [
          'Что такое музыка и откуда она появилась',
          'Как музыка влияет на эмоции человека',
          'Роль музыки в жизни общества',
          'Музыка в разных культурах мира',
          'Практика: обсуждение любимых музыкальных произведений',
        ],
      };
    }

    // Виды музыкальной деятельности
    if (lowerTopicName.includes('виды музыкальной деятельности')) {
      return {
        count: 7,
        names: [
          'Слушание музыки: как понимать произведение',
          'Пение: сольное и хоровое',
          'Игра на инструментах: выбор инструмента',
          'Движение под музыку: танец и пластика',
          'Импровизация: создание музыки на ходу',
          'Сочинение: от идеи до мелодии',
          'Практика: создание собственной музыкальной композиции',
        ],
      };
    }

    // Элементы музыкального языка
    if (lowerTopicName.includes('элементы музыкального языка') || lowerTopicName.includes('звук, высота')) {
      return {
        count: 9,
        names: [
          'Звук: что такое музыкальный звук',
          'Высота: высокие и низкие звуки',
          'Длительность: короткие и долгие звуки',
          'Тембр: голос инструмента',
          'Динамика: громко и тихо',
          'Лад: мажор и минор',
          'Мелодия: главная музыкальная линия',
          'Гармония: сочетание звуков',
          'Фактура и форма: структура произведения',
        ],
      };
    }

    // Ритм и метр
    if (lowerTopicName.includes('ритм и метр') || lowerTopicName.includes('пульс, размер')) {
      return {
        count: 6,
        names: [
          'Пульс в музыке: сердцебиение произведения',
          'Размеры 2/4, 3/4, 4/4: как считать',
          'Ритмические рисунки: короткие и долгие',
          'Запись ритма: длительности нот',
          'Смена темпа: быстро и медленно',
          'Практика: простукивание ритма',
        ],
      };
    }

    // Нотная запись
    if (lowerTopicName.includes('нотная запись') || lowerTopicName.includes('нотоносец, ключи')) {
      return {
        count: 7,
        names: [
          'Нотоносец: пять линеек',
          'Скрипичный и басовый ключи',
          'Длительности нот: целая, половинная, четвертная',
          'Паузы: тишина в музыке',
          'Размер: верхняя и нижняя цифры',
          'Знаки альтерации: диез, бемоль, бекар',
          'Практика: чтение простой мелодии',
        ],
      };
    }

    // Музыкальная фраза
    if (lowerTopicName.includes('музыкальная фраза') || lowerTopicName.includes('мотив, тема')) {
      return {
        count: 5,
        names: [
          'Мотив: самая маленькая музыкальная единица',
          'Фраза: законченная музыкальная мысль',
          'Тема: главная мелодия произведения',
          'Развитие: как тема изменяется',
          'Повтор: возвращение знакомой мелодии',
        ],
      };
    }

    // Музыкальная форма
    if (lowerTopicName.includes('музыкальная форма') || lowerTopicName.includes('период, простые формы')) {
      return {
        count: 7,
        names: [
          'Период: простая музыкальная форма',
          'Двухчастная форма: А-В',
          'Трёхчастная форма: А-В-А',
          'Вариации: тема и её изменения',
          'Рондо: возвращающаяся тема',
          'Практика: определение формы произведения',
          'Создание собственной музыкальной формы',
        ],
      };
    }

    // Жанры музыки
    if (lowerTopicName.includes('жанры музыки') || lowerTopicName.includes('песня, танец, марш')) {
      return {
        count: 8,
        names: [
          'Песня: вокальная музыка',
          'Танец: вальс, полька, менуэт',
          'Марш: торжественная музыка',
          'Колыбельная: успокаивающая мелодия',
          'Гимн: торжественная песня',
          'Хоровод: народный танец',
          'Пьеса, сюита, соната, концерт',
          'Практика: определение жанра по звучанию',
        ],
      };
    }

    // Вокальная музыка
    if (lowerTopicName.includes('вокальная музыка') || lowerTopicName.includes('сольное и хоровое пение')) {
      return {
        count: 6,
        names: [
          'Сольное пение: один голос',
          'Хоровое пение: несколько голосов вместе',
          'Ансамбль: небольшая группа певцов',
          'Хоры разных составов: детский, женский, мужской, смешанный',
          'Практика: разучивание хоровой песни',
          'Выступление перед классом',
        ],
      };
    }

    // Инструментальная музыка
    if (lowerTopicName.includes('инструментальная музыка') || lowerTopicName.includes('сольные инструменты')) {
      return {
        count: 7,
        names: [
          'Сольные инструменты: фортепиано, скрипка, флейта',
          'Ансамбль: несколько инструментов',
          'Оркестр: большой коллектив',
          'Струнные инструменты: скрипка, виолончель',
          'Духовые инструменты: флейта, труба, саксофон',
          'Ударные инструменты: барабаны, ксилофон',
          'Практика: определение инструментов на слух',
        ],
      };
    }

    // Музыкальный фольклор России
    if (lowerTopicName.includes('музыкальный фольклор россии') || lowerTopicName.includes('обрядовые, трудовые')) {
      return {
        count: 7,
        names: [
          'Обрядовые песни: свадьба, масленица, колядки',
          'Трудовые песни: работа в поле, на стройке',
          'Протяжные песни: лирические напевы',
          'Плясовые песни: весёлые и задорные',
          'Былины: сказания о богатырях',
          'Частушки: короткие весёлые песни',
          'Народные инструменты: балалайка, гармонь, гусли',
        ],
      };
    }

    // Народная музыка народов
    if (lowerTopicName.includes('народная музыка народов') || lowerTopicName.includes('музыкальные традиции')) {
      return {
        count: 6,
        names: [
          'Народная музыка России: региональные особенности',
          'Музыка народов Кавказа: характерные ритмы',
          'Музыка народов Сибири: уникальные инструменты',
          'Музыка народов мира: Африка, Азия, Европа',
          'Сходство и различия: общие черты',
          'Практика: сравнение музыкальных традиций',
        ],
      };
    }

    // Русская классическая музыка
    if (lowerTopicName.includes('русская классическая музыка') || lowerTopicName.includes('основные композиторы')) {
      return {
        count: 8,
        names: [
          'Глинка: основоположник русской классики',
          'Чайковский: балеты и симфонии',
          'Мусоргский: народные мотивы',
          'Римский-Корсаков: сказочные оперы',
          'Рахманинов: романтическая музыка',
          'Прокофьев и Шостакович: музыка XX века',
          'Практика: слушание и анализ произведений',
          'Создание презентации о композиторе',
        ],
      };
    }

    // Зарубежная классическая музыка
    if (lowerTopicName.includes('зарубежная классическая музыка') || lowerTopicName.includes('эпохи, стили')) {
      return {
        count: 8,
        names: [
          'Средневековье: григорианские хоралы',
          'Барокко: Бах и Вивальди',
          'Классицизм: Моцарт и Гайдн',
          'Романтизм: Шопен, Шуман, Лист',
          'Музыка XX века: новые направления',
          'Характерные образы каждой эпохи',
          'Практика: определение эпохи по звучанию',
          'Сравнение стилей разных эпох',
        ],
      };
    }

    // Духовная и религиозная музыка
    if (lowerTopicName.includes('духовная') || lowerTopicName.includes('религиозная музыка')) {
      return {
        count: 5,
        names: [
          'Церковное пение: православные традиции',
          'Хоровые традиции: многоголосие',
          'Колокольный звон: музыка без инструментов',
          'Музыка в разных религиях',
          'Практика: слушание духовной музыки',
        ],
      };
    }

    // Музыка в театре и балете
    if (lowerTopicName.includes('музыка в театре и балете') || lowerTopicName.includes('музыкальная драматургия')) {
      return {
        count: 6,
        names: [
          'Музыкальная драматургия: развитие сюжета',
          'Роль оркестра: сопровождение действия',
          'Темы персонажей: лейтмотивы',
          'Балет: музыка и танец',
          'Практика: анализ музыки из балета',
          'Создание музыкального портрета персонажа',
        ],
      };
    }

    // Музыка в опере
    if (lowerTopicName.includes('музыка в опере') || lowerTopicName.includes('вокально-сценические жанры')) {
      return {
        count: 6,
        names: [
          'Опера: музыкальный спектакль',
          'Ария: сольная песня героя',
          'Дуэт, трио, квартет: ансамбли',
          'Хор в опере: массовые сцены',
          'Увертюра: вступление к опере',
          'Практика: слушание оперных фрагментов',
        ],
      };
    }

    // Музыка в кино
    if (lowerTopicName.includes('музыка в кино') || lowerTopicName.includes('саундтрек')) {
      return {
        count: 6,
        names: [
          'Саундтрек: музыка в фильме',
          'Музыка в мультфильмах: от классики до современности',
          'Музыка в телепередачах: заставки и фон',
          'Музыка в компьютерных играх: интерактивность',
          'Звуковой дизайн: создание атмосферы',
          'Практика: анализ музыки из фильма',
        ],
      };
    }

    // Современная популярная музыка
    if (lowerTopicName.includes('современная популярная музыка') || lowerTopicName.includes('поп, рок, джаз')) {
      return {
        count: 7,
        names: [
          'Поп-музыка: популярные хиты',
          'Рок: от классического до альтернативного',
          'Джаз: импровизация и свинг',
          'Рэп: ритм и слово',
          'Электронная музыка: синтезаторы и биты',
          'Молодёжная музыкальная культура',
          'Практика: обсуждение современных направлений',
        ],
      };
    }

    // Музыка и другие виды искусства
    if (lowerTopicName.includes('музыка и другие виды искусства')) {
      return {
        count: 6,
        names: [
          'Музыка и литература: песни на стихи',
          'Музыка и изобразительное искусство: звучащие картины',
          'Музыка и танец: ритм и движение',
          'Музыка и театр: драматическое действие',
          'Практика: создание мультимедийного проекта',
          'Защита творческой работы',
        ],
      };
    }

    // Музыкальная культура родного края
    if (lowerTopicName.includes('музыкальная культура родного края')) {
      return {
        count: 5,
        names: [
          'Местные музыкальные традиции',
          'Исполнители и коллективы региона',
          'Фестивали и концерты',
          'Музеи музыкальных инструментов',
          'Практика: создание проекта о местной музыке',
        ],
      };
    }

    // Музыкально-пластическое движение
    if (lowerTopicName.includes('музыкально-пластическое движение') || lowerTopicName.includes('танцевальные элементы')) {
      return {
        count: 5,
        names: [
          'Движение под музыку: ритм и пластика',
          'Танцевальные элементы: основные шаги',
          'Передача характера музыки движением',
          'Практика: создание танцевальной композиции',
          'Выступление перед классом',
        ],
      };
    }

    // Основы музыкального творчества
    if (lowerTopicName.includes('основы музыкального творчества') || lowerTopicName.includes('импровизация')) {
      return {
        count: 6,
        names: [
          'Элементарная импровизация голосом',
          'Импровизация на инструментах',
          'Придумывание ритмов: от простого к сложному',
          'Создание мелодий: от мотива к фразе',
          'Практика: импровизация на заданную тему',
          'Запись собственной мелодии',
        ],
      };
    }

    // Цифровые технологии в музыке
    if (lowerTopicName.includes('цифровые технологии в музыке') || lowerTopicName.includes('запись и обработка звука')) {
      return {
        count: 6,
        names: [
          'Запись звука: микрофон и компьютер',
          'Обработка звука: эффекты и фильтры',
          'Музыкальные приложения: GarageBand, Audacity',
          'Музыкальные редакторы: создание композиции',
          'Создание плейлистов: подбор музыки',
          'Практика: создание простой фонограммы',
        ],
      };
    }

    // Проектная деятельность в музыке
    if (lowerTopicName.includes('проектная деятельность в музыке') || lowerTopicName.includes('афиша и программа')) {
      return {
        count: 6,
        names: [
          'Афиша концерта: дизайн и информация',
          'Программа концерта: список произведений',
          'Школьный музыкальный спектакль: от идеи до постановки',
          'Виртуальный музей инструментов: создание презентации',
          'Музыкальный портрет класса: сбор материала',
          'Защита музыкального проекта',
        ],
      };
    }

    // === МИРОВАЯ ХУДОЖЕСТВЕННАЯ КУЛЬТУРА ===

    // Понятие художественной культуры
    if (lowerTopicName.includes('понятие художественной культуры') || lowerTopicName.includes('культура, искусство, стиль')) {
      return {
        count: 6,
        names: [
          'Что такое культура: от быта до искусства',
          'Искусство: творчество и красота',
          'Стиль: узнаваемые черты эпохи',
          'Жанр: виды произведений искусства',
          'Художественный образ: идея в произведении',
          'Практика: анализ произведения искусства',
        ],
      };
    }

    // Виды искусств
    if (lowerTopicName.includes('виды искусств: архитектура') || lowerTopicName.includes('архитектура, изобразительное искусство')) {
      return {
        count: 10,
        names: [
          'Архитектура: искусство строить',
          'Изобразительное искусство: живопись и графика',
          'Скульптура: объём и форма',
          'Декоративно-прикладное искусство: красота в быту',
          'Литература: искусство слова',
          'Музыка: искусство звука',
          'Театр: синтез искусств',
          'Кино: движущееся изображение',
          'Балет: танец и музыка',
          'Фотография и медиа-арт: современные виды',
        ],
      };
    }

    // Первобытное искусство
    if (lowerTopicName.includes('первобытное искусство') || lowerTopicName.includes('наскальные росписи')) {
      return {
        count: 6,
        names: [
          'Наскальные росписи: первые картины человечества',
          'Статуэтки: изображение человека',
          'Мегалиты: каменные сооружения',
          'Магико-ритуальная функция: искусство и вера',
          'Практика: анализ первобытных изображений',
          'Создание проекта о первобытном искусстве',
        ],
      };
    }

    // Искусство древнейших цивилизаций
    if (lowerTopicName.includes('искусство древнейших цивилизаций') || lowerTopicName.includes('египет, месопотамия')) {
      return {
        count: 7,
        names: [
          'Египет: пирамиды и фараоны',
          'Месопотамия: зиккураты и рельефы',
          'Индия: храмы и скульптура',
          'Китай: пагоды и каллиграфия',
          'Культовые образы: боги и герои',
          'Практика: сравнение культур',
          'Создание презентации о древней цивилизации',
        ],
      };
    }

    // Художественная культура Древней Греции
    if (lowerTopicName.includes('художественная культура древней греции') || lowerTopicName.includes('храм, ордер')) {
      return {
        count: 7,
        names: [
          'Храм: архитектура богов',
          'Ордер: дорический, ионический, коринфский',
          'Скульптура: идеал красоты',
          'Вазопись: рисунки на сосудах',
          'Театр: трагедия и комедия',
          'Практика: анализ греческого искусства',
          'Создание проекта о Древней Греции',
        ],
      };
    }

    // Искусство Древнего Рима
    if (lowerTopicName.includes('искусство древнего рима') || lowerTopicName.includes('форум, амфитеатр')) {
      return {
        count: 7,
        names: [
          'Форум: центр римской жизни',
          'Амфитеатр: Колизей и гладиаторы',
          'Термы: римские бани',
          'Скульптура: портреты императоров',
          'Мозаика: изображения из камня',
          'Роль Рима в распространении античной традиции',
          'Практика: сравнение Греции и Рима',
        ],
      };
    }

    // Художественная культура Средневековой Европы
    if (lowerTopicName.includes('художественная культура средневековой европы') || lowerTopicName.includes('романика и готика')) {
      return {
        count: 7,
        names: [
          'Романика: массивные соборы',
          'Готика: устремлённые вверх соборы',
          'Собор: центр средневекового города',
          'Витраж: цветное стекло',
          'Икона: священное изображение',
          'Книжная миниатюра: иллюстрации в рукописях',
          'Практика: анализ готического собора',
        ],
      };
    }

    // Византия и Древняя Русь
    if (lowerTopicName.includes('византия и древняя русь') || lowerTopicName.includes('храм, икона, фреска')) {
      return {
        count: 7,
        names: [
          'Византийский храм: купол и крест',
          'Икона: образ и символ',
          'Фреска: роспись по сырой штукатурке',
          'Мозаика: изображение из смальты',
          'Синтез веры и искусства',
          'Практика: анализ древнерусской иконы',
          'Создание проекта о древнерусском искусстве',
        ],
      };
    }

    // Художественная культура средневекового Востока
    if (lowerTopicName.includes('художественная культура средневекового востока') || lowerTopicName.includes('исламская архитектура')) {
      return {
        count: 7,
        names: [
          'Исламская архитектура: мечети и минареты',
          'Каллиграфия: искусство письма',
          'Орнамент: геометрические узоры',
          'Миниатюра: книжная живопись',
          'Буддийское искусство: храмы и статуи',
          'Практика: сравнение восточного и западного искусства',
          'Создание орнамента в восточном стиле',
        ],
      };
    }

    // Ренессанс
    if (lowerTopicName.includes('ренессанс в италии') || lowerTopicName.includes('леонардо, микеланджело')) {
      return {
        count: 8,
        names: [
          'Человек как мера вещей: гуманизм',
          'Перспектива: создание глубины',
          'Портрет: индивидуальность человека',
          'Монументальная живопись: фрески',
          'Леонардо да Винчи: гений эпохи',
          'Микеланджело: скульптор и живописец',
          'Рафаэль: гармония и красота',
          'Практика: анализ произведений Возрождения',
        ],
      };
    }

    // Барокко и классицизм
    if (lowerTopicName.includes('искусство барокко и классицизма') || lowerTopicName.includes('дворец, парк')) {
      return {
        count: 7,
        names: [
          'Барокко: пышность и движение',
          'Классицизм: строгость и порядок',
          'Дворец: Версаль и Петергоф',
          'Парк: регулярный и пейзажный',
          'Театр: сценическое искусство',
          'Парадный портрет: величие и роскошь',
          'Практика: сравнение барокко и классицизма',
        ],
      };
    }

    // Искусство XVIII века в России
    if (lowerTopicName.includes('искусство xviii века в россии') || lowerTopicName.includes('петербург как художественный центр')) {
      return {
        count: 6,
        names: [
          'Петербург: новая столица искусства',
          'Архитектура: Растрелли и Кваренги',
          'Живопись: портреты и исторические картины',
          'Скульптура: памятники и статуи',
          'Практика: анализ русского искусства XVIII века',
          'Создание проекта о Петербурге',
        ],
      };
    }

    // Искусство XIX века в Европе
    if (lowerTopicName.includes('искусство xix века в европе') || lowerTopicName.includes('романтизм, реализм')) {
      return {
        count: 7,
        names: [
          'Романтизм: эмоции и природа',
          'Реализм: правда жизни',
          'Импрессионизм: впечатление и свет',
          'Постимпрессионизм: после импрессионистов',
          'Практика: анализ картин разных направлений',
          'Сравнение стилей XIX века',
          'Создание презентации о направлении',
        ],
      };
    }

    // Русское искусство XIX века
    if (lowerTopicName.includes('русское искусство xix века') || lowerTopicName.includes('передвижники')) {
      return {
        count: 7,
        names: [
          'От классицизма к реализму: эволюция стиля',
          'Передвижники: художники-реалисты',
          'Национальные мотивы: русская тема',
          'Пейзаж: природа России',
          'Портрет: образы современников',
          'Практика: анализ картин передвижников',
          'Создание проекта о русском искусстве',
        ],
      };
    }

    // Архитектура XIX – начала XX века
    if (lowerTopicName.includes('архитектура и градостроительство xix') || lowerTopicName.includes('эклектика, модерн')) {
      return {
        count: 6,
        names: [
          'Эклектика: смешение стилей',
          'Модерн: новый стиль рубежа веков',
          'Новые материалы: железо и стекло',
          'Технологии: лифты и отопление',
          'Практика: анализ зданий в стиле модерн',
          'Создание проекта о современной архитектуре',
        ],
      };
    }

    // Искусство первой половины XX века
    if (lowerTopicName.includes('искусство первой половины xx века') || lowerTopicName.includes('авангард, кубизм')) {
      return {
        count: 8,
        names: [
          'Авангард: революция в искусстве',
          'Кубизм: геометрические формы',
          'Футуризм: движение и скорость',
          'Абстракция: беспредметное искусство',
          'Баухауз: школа дизайна',
          'Новые формы в архитектуре',
          'Дизайн: функциональность и красота',
          'Практика: анализ авангардных произведений',
        ],
      };
    }

    // Русский и советский авангард
    if (lowerTopicName.includes('русский и советский авангард') || lowerTopicName.includes('малевич, кандинский')) {
      return {
        count: 7,
        names: [
          'Малевич: чёрный квадрат',
          'Кандинский: абстрактная живопись',
          'Конструктивизм: искусство и производство',
          'Дизайн: от идеи к вещи',
          'Плакат: агитационное искусство',
          'Практика: анализ произведений авангарда',
          'Создание проекта о русском авангарде',
        ],
      };
    }

    // Искусство второй половины XX – начала XXI века
    if (lowerTopicName.includes('искусство второй половины xx') || lowerTopicName.includes('поп-арт, концептуализм')) {
      return {
        count: 8,
        names: [
          'Поп-арт: искусство массовой культуры',
          'Концептуализм: идея важнее формы',
          'Перформанс: искусство действия',
          'Инсталляция: пространственное искусство',
          'Стрит-арт: искусство на улице',
          'Цифровое искусство: компьютер и творчество',
          'Практика: анализ современного искусства',
          'Создание собственного арт-проекта',
        ],
      };
    }

    // Музыка в системе МХК
    if (lowerTopicName.includes('музыка в системе мхк') || lowerTopicName.includes('народная, классическая')) {
      return {
        count: 7,
        names: [
          'Народная музыка: традиции и фольклор',
          'Классическая музыка: от барокко до современности',
          'Джаз: импровизация и свинг',
          'Рок: от битлов до наших дней',
          'Академическая музыка: симфонии и оперы',
          'Массовая музыка: поп и эстрада',
          'Практика: музыка в контексте эпохи',
        ],
      };
    }

    // Театр, опера и балет
    if (lowerTopicName.includes('театр, опера и балет') || lowerTopicName.includes('драматический театр')) {
      return {
        count: 7,
        names: [
          'Драматический театр: слово и действие',
          'Музыкальный театр: опера и оперетта',
          'Балет: танец и музыка',
          'Роль режиссёра: создание спектакля',
          'Артист: воплощение образа',
          'Сценография: оформление сцены',
          'Практика: анализ театральной постановки',
        ],
      };
    }

    // Кино и анимация
    if (lowerTopicName.includes('кино и анимация') || lowerTopicName.includes('язык кино, монтаж')) {
      return {
        count: 7,
        names: [
          'Язык кино: кадр и монтаж',
          'Режиссура: создание фильма',
          'Основные направления: от немого кино до блокбастеров',
          'Шедевры мирового кино',
          'Отечественное кино: от Эйзенштейна до наших дней',
          'Анимация: мультфильмы и аниме',
          'Практика: анализ фильма',
        ],
      };
    }

    // Декоративно-прикладное искусство и дизайн
    if (lowerTopicName.includes('декоративно-прикладное искусство и дизайн') || lowerTopicName.includes('национальные традиции')) {
      return {
        count: 7,
        names: [
          'Национальные традиции: народные промыслы',
          'Орнамент: повторяющиеся узоры',
          'Художественные промыслы: хохлома, гжель, палех',
          'Современный промышленный дизайн',
          'Дизайн предметов быта',
          'Практика: создание декоративного изделия',
          'Защита дизайн-проекта',
        ],
      };
    }

    // Религия и искусство
    if (lowerTopicName.includes('религия и искусство') || lowerTopicName.includes('христианская, мусульманская')) {
      return {
        count: 6,
        names: [
          'Христианское искусство: иконы и храмы',
          'Мусульманское искусство: мечети и каллиграфия',
          'Буддийское искусство: храмы и мандалы',
          'Иудейское искусство: синагоги и рукописи',
          'Художественные традиции разных религий',
          'Практика: сравнение религиозного искусства',
        ],
      };
    }

    // Национальные художественные школы
    if (lowerTopicName.includes('национальные художественные школы') || lowerTopicName.includes('европа, россия, восток')) {
      return {
        count: 8,
        names: [
          'Европейская школа: от античности до современности',
          'Русская школа: самобытность и традиции',
          'Восток: Китай, Япония, Индия',
          'Америка: от индейцев до поп-арта',
          'Африка: традиционное и современное',
          'Латинская Америка: яркость и экспрессия',
          'Диалог культур: взаимовлияние',
          'Практика: сравнение художественных школ',
        ],
      };
    }

    // Художественная культура родного края
    if (lowerTopicName.includes('художественная культура родного края') || lowerTopicName.includes('архитектура, музеи')) {
      return {
        count: 6,
        names: [
          'Архитектура региона: знаменитые здания',
          'Музеи: коллекции и экспозиции',
          'Памятники: история в камне',
          'Локальные художники и коллективы',
          'Практика: посещение музея или выставки',
          'Создание проекта о культуре края',
        ],
      };
    }

    // Анализ произведения искусства
    if (lowerTopicName.includes('анализ произведения искусства') || lowerTopicName.includes('тема, сюжет, композиция')) {
      return {
        count: 8,
        names: [
          'Тема: о чём произведение',
          'Сюжет: что происходит',
          'Композиция: как расположены элементы',
          'Цвет и свет: создание настроения',
          'Пространство: глубина и объём',
          'Символика: скрытые смыслы',
          'Авторская позиция: что хотел сказать автор',
          'Практика: полный анализ произведения',
        ],
      };
    }

    // Музей, выставка, театр
    if (lowerTopicName.includes('музей, выставка, театр') || lowerTopicName.includes('культурное пространство')) {
      return {
        count: 6,
        names: [
          'Музей: хранилище культуры',
          'Выставка: временная экспозиция',
          'Театр: живое искусство',
          'Филармония: концертный зал',
          'Кинотеатр: искусство на экране',
          'Правила поведения и навыки культурного потребления',
        ],
      };
    }

    // Современное искусство и медиа
    if (lowerTopicName.includes('современное искусство и медиа') || lowerTopicName.includes('реклама, клипы')) {
      return {
        count: 7,
        names: [
          'Реклама: искусство убеждения',
          'Клипы: музыка и визуал',
          'Компьютерные игры: интерактивное искусство',
          'Соцсети: искусство в интернете',
          'Граница между массовой культурой и искусством',
          'Практика: анализ медиа-произведения',
          'Создание собственного медиа-проекта',
        ],
      };
    }

    // По умолчанию для остальных тем (5 уроков)
    return {
      count: 5,
      names: [
        `Введение в тему: ${topicName.length > 40 ? topicName.substring(0, 37) + '...' : topicName}`,
        'Основные понятия и определения',
        'Правила и закономерности',
        'Практические примеры и упражнения',
        'Итоговое закрепление материала',
      ],
    };
  }

  public async up(queryRunner: QueryRunner): Promise<void> {
    console.log('🎨 Начинаю добавление уроков для дисциплин "Искусство"...');

    // Проверяем существование таблицы lessons
    const tableExists = await queryRunner.query(`
      SELECT 1 FROM information_schema.tables 
      WHERE table_schema = 'public' AND table_name = 'lessons'
    `);

    if (!(Array.isArray(tableExists) && tableExists.length > 0)) {
      throw new Error('Table lessons does not exist');
    }

    // Проверяем существование колонок
    const isVerifiedExists = await queryRunner.query(`
      SELECT 1 FROM information_schema.columns 
      WHERE table_schema = 'public' 
      AND table_name = 'lessons' 
      AND column_name = 'IsVerified'
    `);

    if (!(Array.isArray(isVerifiedExists) && isVerifiedExists.length > 0)) {
      throw new Error('Column IsVerified does not exist. Please run migration 1763600000000-AddFieldsToLessons first.');
    }

    // Получаем максимальный ID уроков
    const maxIdResult = await queryRunner.query(`
      SELECT COALESCE(MAX("ID"), 0) as max_id FROM "lessons"
    `);
    const maxLessonId = parseInt(maxIdResult[0]?.max_id || '0', 10);
    let nextLessonId = maxLessonId + 1;

    // Получаем все темы для дисциплин "Искусство"
    const disciplines = [
      'b5d4f3e2-8c1e-4f57-8d0b-2e1f3a4b5c6d', // Изобразительное искусство
      'c6e5a4b3-9d2f-4028-9e1c-3f2a4b5c6d7e', // Музыка
      'd6e5f4a3-9b2d-5028-1f3d-3a4b5c6d7e8f', // Мировая художественная культура
    ];

    // Используем простой запрос без параметров для TypeORM
    const disciplinesStr = disciplines.map(d => `'${d}'`).join(', ');
    const topicsResult = await queryRunner.query(`
      SELECT "TopicID", "TopicName", "DisciplineID"
      FROM "topics"
      WHERE "DisciplineID" IN (${disciplinesStr})
      ORDER BY "DisciplineID", "ID"
    `);

    if (!Array.isArray(topicsResult) || topicsResult.length === 0) {
      console.log('⚠️  Темы для дисциплин "Искусство" не найдены');
      return;
    }

    console.log(`📝 Найдено ${topicsResult.length} тем для обработки`);

    // Проверяем, есть ли уже уроки для этих тем
    const topicIds = topicsResult.map(t => t.TopicID);
    if (topicIds.length === 0) {
      console.log('⚠️  Темы не найдены');
      return;
    }
    
    const topicIdsStr = topicIds.map(id => `'${id}'`).join(', ');
    const existingLessons = await queryRunner.query(`
      SELECT COUNT(*) as count FROM "lessons"
      WHERE "TopicID" IN (${topicIdsStr})
    `);

    const existingCount = parseInt(existingLessons[0]?.count || '0', 10);
    if (existingCount > 0) {
      console.log(`⚠️  Для некоторых тем уже существуют ${existingCount} уроков. Пропускаем создание дубликатов (используется ON CONFLICT DO NOTHING).`);
      // Продолжаем выполнение - ON CONFLICT DO NOTHING пропустит существующие уроки
    }

    // Генерируем уроки для каждой темы
    const allLessons: Array<{
      LessonID: string;
      ID: number;
      LessonName: string;
      TopicID: string;
      IsVerified: boolean;
      Order: number;
      Description: string | null;
      CreatedAt: Date;
      UpdatedAt: Date;
    }> = [];

    for (const topic of topicsResult) {
      const lessonPlan = this.getLessonPlanForTopic(topic.TopicName);
      const lessons = this.generateLessonsForTopic(
        topic.TopicID,
        topic.TopicName,
        lessonPlan.count,
        lessonPlan.names,
        nextLessonId,
      );
      allLessons.push(...lessons);
      nextLessonId += lessonPlan.count;
    }

    console.log(`📚 Создано ${allLessons.length} уроков для ${topicsResult.length} тем`);

    // Вставляем уроки батчами по 50 для эффективности
    const batchSize = 50;
    for (let i = 0; i < allLessons.length; i += batchSize) {
      const batch = allLessons.slice(i, i + batchSize);
      
      // Создаем значения для INSERT, используя детерминированный UUID
      const values = batch
        .map(
          (lesson, idx) => {
            // Генерируем детерминированный UUID на основе TopicID и ID урока
            const seed = `${lesson.TopicID}-${lesson.ID}`;
            let hash1 = 0, hash2 = 0, hash3 = 0, hash4 = 0;
            for (let i = 0; i < seed.length; i++) {
              const char = seed.charCodeAt(i);
              hash1 = ((hash1 << 5) - hash1) + char;
              hash2 = ((hash2 << 7) - hash2) + char + i;
              hash3 = ((hash3 << 3) - hash3) + char * 3;
              hash4 = ((hash4 << 11) - hash4) + char * 7;
            }
            // Генерируем части UUID (8-4-4-4-12 символов)
            const h1 = Math.abs(hash1).toString(16).padStart(8, '0').substring(0, 8);
            const h2 = Math.abs(hash2).toString(16).padStart(4, '0').substring(0, 4);
            const h3 = Math.abs(hash3).toString(16).padStart(3, '0').substring(0, 3);
            const h4 = (Math.abs(hash1 + hash2) % 4); // 0-3 для выбора 8,9,a,b
            const variant = ['8', '9', 'a', 'b'][h4];
            const h5 = Math.abs(hash3 + hash4).toString(16).padStart(3, '0').substring(0, 3);
            const h6 = Math.abs(hash1 * hash2).toString(16).padStart(12, '0').substring(0, 12);
            const lessonId = `${h1}-${h2}-4${h3}-${variant}${h5}-${h6}`;
            
            return `(
              '${lessonId}',
              ${lesson.ID},
              ${this.escapeString(lesson.LessonName)},
              '${lesson.TopicID}'::uuid,
              ${lesson.IsVerified},
              ${lesson.Order !== null ? lesson.Order : 'NULL'},
              ${lesson.Description ? this.escapeString(lesson.Description) : 'NULL'},
              '${lesson.CreatedAt.toISOString()}'::timestamp,
              '${lesson.UpdatedAt.toISOString()}'::timestamp
            )`;
          }
        )
        .join(',');

      await queryRunner.query(`
        INSERT INTO "lessons" (
          "LessonID", "ID", "LessonName", "TopicID", 
          "IsVerified", "Order", "Description", 
          "CreatedAt", "UpdatedAt"
        )
        VALUES ${values}
        ON CONFLICT ("LessonID") DO NOTHING
      `);
    }

    console.log('✅ Уроки успешно добавлены!');
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    console.log('🔄 Откатываю добавление уроков...');

    // Удаляем уроки для тем дисциплин "Искусство"
    const disciplines = [
      'b5d4f3e2-8c1e-4f57-8d0b-2e1f3a4b5c6d', // Изобразительное искусство
      'c6e5a4b3-9d2f-4028-9e1c-3f2a4b5c6d7e', // Музыка
      'd6e5f4a3-9b2d-5028-1f3d-3a4b5c6d7e8f', // Мировая художественная культура
    ];

    const disciplinesStr = disciplines.map(d => `'${d}'`).join(', ');
    await queryRunner.query(`
      DELETE FROM "lessons"
      WHERE "TopicID" IN (
        SELECT "TopicID" FROM "topics"
        WHERE "DisciplineID" IN (${disciplinesStr})
      )
    `);

    console.log('✅ Откат завершен');
  }
}

